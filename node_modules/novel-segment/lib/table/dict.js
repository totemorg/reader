"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const segment_1 = require("segment-dict/lib/loader/segment");
const cjk_1 = require("../util/cjk");
const core_1 = require("./core");
const util_1 = require("../util");
/**
 * @todo 掛接其他 dict
 */
class TableDict extends core_1.default {
    constructor() {
        super(...arguments);
        this.TABLE = {};
        this.TABLE2 = {};
    }
    exists(data) {
        let w, p, f;
        if (typeof data == 'string') {
            w = data;
        }
        else if (Array.isArray(data)) {
            [w, p, f] = data;
        }
        else {
            ({ w, p, f } = data);
        }
        return this.TABLE[w] || null;
    }
    __handleInput(data) {
        let w, p, f;
        let plus;
        if (typeof data == 'string') {
            w = data;
        }
        else if (Array.isArray(data)) {
            [w, p, f, ...plus] = data;
        }
        else {
            ({ w, p, f } = data);
        }
        if (typeof w !== 'string' || w === '') {
            throw new TypeError(JSON.stringify(data));
        }
        p = (typeof p != 'number' || Number.isNaN(p)) ? 0 : p;
        f = (typeof f != 'number' || Number.isNaN(f)) ? 0 : f;
        return {
            data: {
                w, p, f,
            },
            plus,
        };
    }
    add(data, skipExists) {
        let w, p, f;
        let plus;
        {
            let ret = this.__handleInput(data);
            ({ w, p, f } = ret.data);
            plus = ret.plus;
        }
        if (skipExists && this.exists(w)) {
            return this;
        }
        if (plus && plus.length) {
            // @todo do something
        }
        this._add({ w, p, f, s: true });
        let self = this;
        /**
         * @todo 需要更聰明的作法 目前的做法實在太蠢
         * @BUG 在不明原因下 似乎不會正確的添加每個項目 如果遇到這種情形請手動添加簡繁項目
         */
        if (1 && this.options.autoCjk) {
            let wa = cjk_1.text_list(w);
            wa.forEach(function (w2) {
                if (w2 != w && !self.exists(w2)) {
                    self._add({ w: w2, p, f });
                }
            });
            /*
            let w2: string;
            w2 = CjkConv.zh2jp(w);

            if (w2 != w && !this.exists(w2))
            {
                this._add({w: w2, p, f});
                //console.log(w2);
            }

            w2 = CjkConv.cjk2zht(w);

            if (w2 !== w && !this.exists(w2))
            {
                this._add({w: w2, p, f});
                //console.log(w2);
            }

            w2 = CjkConv.cjk2zhs(w);

            if (w2 !== w && !this.exists(w2))
            {
                this._add({w: w2, p, f});
                //console.log(w2);
            }
            */
        }
        return this;
    }
    _add({ w, p, f, s }) {
        let len = w.length;
        this.TABLE[w] = {
            p,
            f,
            s,
        };
        if (!this.TABLE2[len])
            this.TABLE2[len] = {};
        this.TABLE2[len][w] = this.TABLE[w];
    }
    remove(target) {
        let { data, plus } = this.__handleInput(target);
        this._remove(data);
        return this;
    }
    _remove({ w, p, f, s }) {
        let len = w.length;
        delete this.TABLE[w];
        if (this.TABLE2[len]) {
            delete this.TABLE2[len][w];
        }
        return this;
    }
    json() {
        return util_1.cloneDeep(this.TABLE);
    }
    /**
     * 將目前的 表格 匯出
     */
    stringify(LF = "\n") {
        let self = this;
        return Object.entries(self.TABLE)
            .reduce(function (a, [w, { p, f }]) {
            let line = segment_1.stringifyLine([w, p, f]);
            a.push(line);
            return a;
        }, [])
            .join(typeof LF === 'string' ? LF : "\n");
    }
}
exports.TableDict = TableDict;
exports.default = TableDict;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGljdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRpY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSw2REFBcUY7QUFFckYscUNBQXdDO0FBQ3hDLGlDQUF3RTtBQUN4RSxrQ0FBb0M7QUFZcEM7O0dBRUc7QUFDSCxNQUFhLFNBQVUsU0FBUSxjQUFvQztJQUFuRTs7UUFJQyxVQUFLLEdBQXlCLEVBQUUsQ0FBQztRQUNqQyxXQUFNLEdBQTBCLEVBQUUsQ0FBQztJQXFNcEMsQ0FBQztJQWpNQSxNQUFNLENBQUMsSUFBK0I7UUFFckMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVaLElBQUksT0FBTyxJQUFJLElBQUksUUFBUSxFQUMzQjtZQUNDLENBQUMsR0FBRyxJQUFJLENBQUM7U0FDVDthQUNJLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFDNUI7WUFDQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO1NBQ2pCO2FBRUQ7WUFDQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztTQUNyQjtRQUVELE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUM7SUFDOUIsQ0FBQztJQUVTLGFBQWEsQ0FBQyxJQUErQjtRQUV0RCxJQUFJLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUyxDQUFDO1FBQ3BDLElBQUksSUFBNEIsQ0FBQztRQUVqQyxJQUFJLE9BQU8sSUFBSSxJQUFJLFFBQVEsRUFDM0I7WUFDQyxDQUFDLEdBQUcsSUFBSSxDQUFDO1NBQ1Q7YUFDSSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQzVCO1lBQ0MsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztT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LENBQUM7WUFFYixPQUFPLENBQUMsQ0FBQTtRQUNULENBQUMsRUFBRSxFQUFFLENBQUM7YUFDTCxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUN4QztJQUNILENBQUM7Q0FDRDtBQTFNRCw4QkEwTUM7QUFFRCxrQkFBZSxTQUFTLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgdXNlciBvbiAyMDE4LzQvMTUvMDE1LlxuICovXG5pbXBvcnQgeyBJV29yZCB9IGZyb20gJy4uL3NlZ21lbnQvdHlwZXMnO1xuaW1wb3J0IHsgSURpY3RSb3csIHNlcmlhbGl6ZSwgc3RyaW5naWZ5TGluZSB9IGZyb20gJ3NlZ21lbnQtZGljdC9saWIvbG9hZGVyL3NlZ21lbnQnO1xuaW1wb3J0IENqa0NvbnYgZnJvbSAnY2prLWNvbnYnO1xuaW1wb3J0IHsgdGV4dF9saXN0IH0gZnJvbSAnLi4vdXRpbC9jamsnO1xuaW1wb3J0IEFic3RyYWN0VGFibGVEaWN0Q29yZSwgeyBJRElDVCwgSURJQ1QyLCBJT3B0aW9ucyB9IGZyb20gJy4vY29yZSc7XG5pbXBvcnQgeyBjbG9uZURlZXAgfSBmcm9tICcuLi91dGlsJztcblxuZGVjbGFyZSBmdW5jdGlvbiBfY2xvbmVEZWVwPFQ+KGRhdGE6IFQpOiBUXG5cbmV4cG9ydCB0eXBlIElUYWJsZURpY3RSb3cgPSB7XG5cdHA6IG51bWJlcixcblx0ZjogbnVtYmVyLFxuXHRzPzogYm9vbGVhbixcbn07XG5cbmV4cG9ydCB7IElESUNULCBJRElDVDIsIElPcHRpb25zIH1cblxuLyoqXG4gKiBAdG9kbyDmjpvmjqXlhbbku5YgZGljdFxuICovXG5leHBvcnQgY2xhc3MgVGFibGVEaWN0IGV4dGVuZHMgQWJzdHJhY3RUYWJsZURpY3RDb3JlPElUYWJsZURpY3RSb3c+XG57XG5cdHB1YmxpYyB0eXBlOiBzdHJpbmc7XG5cblx0VEFCTEU6IElESUNUPElUYWJsZURpY3RSb3c+ID0ge307XG5cdFRBQkxFMjogSURJQ1QyPElUYWJsZURpY3RSb3c+ID0ge307XG5cblx0b3B0aW9uczogSU9wdGlvbnM7XG5cblx0ZXhpc3RzKGRhdGE6IElXb3JkIHwgSURpY3RSb3cgfCBzdHJpbmcpOiBJVGFibGVEaWN0Um93XG5cdHtcblx0XHRsZXQgdywgcCwgZjtcblxuXHRcdGlmICh0eXBlb2YgZGF0YSA9PSAnc3RyaW5nJylcblx0XHR7XG5cdFx0XHR3ID0gZGF0YTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSlcblx0XHR7XG5cdFx0XHRbdywgcCwgZl0gPSBkYXRhO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0KHsgdywgcCwgZiB9ID0gZGF0YSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuVEFCTEVbd10gfHwgbnVsbDtcblx0fVxuXG5cdHByb3RlY3RlZCBfX2hhbmRsZUlucHV0KGRhdGE6IElXb3JkIHwgSURpY3RSb3cgfCBzdHJpbmcpXG5cdHtcblx0XHRsZXQgdzogc3RyaW5nLCBwOiBudW1iZXIsIGY6IG51bWJlcjtcblx0XHRsZXQgcGx1czogQXJyYXk8c3RyaW5nIHwgbnVtYmVyPjtcblxuXHRcdGlmICh0eXBlb2YgZGF0YSA9PSAnc3RyaW5nJylcblx0XHR7XG5cdFx0XHR3ID0gZGF0YTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSlcblx0XHR7XG5cdFx0XHRbdywgcCwgZiwgLi4ucGx1c10gPSBkYXRhO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0KHsgdywgcCwgZiB9ID0gZGF0YSk7XG5cdFx0fVxuXG5cdFx0aWYgKHR5cGVvZiB3ICE9PSAnc3RyaW5nJyB8fCB3ID09PSAnJylcblx0XHR7XG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcblx0XHR9XG5cblx0XHRwID0gKHR5cGVvZiBwICE9ICdudW1iZXInIHx8IE51bWJlci5pc05hTihwKSkgPyAwIDogcDtcblx0XHRmID0gKHR5cGVvZiBmICE9ICdudW1iZXInIHx8IE51bWJlci5pc05hTihmKSkgPyAwIDogZjtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRkYXRhOiB7XG5cdFx0XHRcdHcsIHAsIGYsXG5cdFx0XHR9LFxuXHRcdFx0cGx1cyxcblx0XHR9XG5cdH1cblxuXHRhZGQoZGF0YTogSVdvcmQgfCBJRGljdFJvdyB8IHN0cmluZywgc2tpcEV4aXN0cz86IGJvb2xlYW4pXG5cdHtcblx0XHRsZXQgdzogc3RyaW5nLCBwOiBudW1iZXIsIGY6IG51bWJlcjtcblx0XHRsZXQgcGx1czogQXJyYXk8c3RyaW5nIHwgbnVtYmVyPjtcblxuXHRcdHtcblx0XHRcdGxldCByZXQgPSB0aGlzLl9faGFuZGxlSW5wdXQoZGF0YSk7XG5cblx0XHRcdCh7IHcsIHAsIGYgfSA9IHJldC5kYXRhKTtcblx0XHRcdHBsdXMgPSByZXQucGx1cztcblx0XHR9XG5cblx0XHRpZiAoc2tpcEV4aXN0cyAmJiB0aGlzLmV4aXN0cyh3KSlcblx0XHR7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHRpZiAocGx1cyAmJiBwbHVzLmxlbmd0aClcblx0XHR7XG5cdFx0XHQvLyBAdG9kbyBkbyBzb21ldGhpbmdcblx0XHR9XG5cblx0XHR0aGlzLl9hZGQoeyB3LCBwLCBmLCBzOiB0cnVlIH0pO1xuXG5cdFx0bGV0IHNlbGYgPSB0aGlzO1xuXG5cdFx0LyoqXG5cdFx0ICogQHRvZG8g6ZyA6KaB5pu06IGw5piO55qE5L2c5rOVIOebruWJjeeahOWBmuazleWvpuWcqOWkquigolxuXHRcdCAqIEBCVUcg5Zyo5LiN5piO5Y6f5Zug5LiLIOS8vOS5juS4jeacg+ato+eiuueahOa3u+WKoOavj+WAi+mgheebriDlpoLmnpzpgYfliLDpgJnnqK7mg4XlvaLoq4vmiYvli5Xmt7vliqDnsKHnuYHpoIXnm65cblx0XHQgKi9cblx0XHRpZiAoMSAmJiB0aGlzLm9wdGlvbnMuYXV0b0Nqaylcblx0XHR7XG5cdFx0XHRsZXQgd2EgPSB0ZXh0X2xpc3Qodyk7XG5cblx0XHRcdHdhLmZvckVhY2goZnVuY3Rpb24gKHcyKVxuXHRcdFx0e1xuXHRcdFx0XHRpZiAodzIgIT0gdyAmJiAhc2VsZi5leGlzdHModzIpKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0c2VsZi5fYWRkKHsgdzogdzIsIHAsIGYgfSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvKlxuXHRcdFx0bGV0IHcyOiBzdHJpbmc7XG5cdFx0XHR3MiA9IENqa0NvbnYuemgyanAodyk7XG5cblx0XHRcdGlmICh3MiAhPSB3ICYmICF0aGlzLmV4aXN0cyh3MikpXG5cdFx0XHR7XG5cdFx0XHRcdHRoaXMuX2FkZCh7dzogdzIsIHAsIGZ9KTtcblx0XHRcdFx0Ly9jb25zb2xlLmxvZyh3Mik7XG5cdFx0XHR9XG5cblx0XHRcdHcyID0gQ2prQ29udi5jamsyemh0KHcpO1xuXG5cdFx0XHRpZiAodzIgIT09IHcgJiYgIXRoaXMuZXhpc3RzKHcyKSlcblx0XHRcdHtcblx0XHRcdFx0dGhpcy5fYWRkKHt3OiB3MiwgcCwgZn0pO1xuXHRcdFx0XHQvL2NvbnNvbGUubG9nKHcyKTtcblx0XHRcdH1cblxuXHRcdFx0dzIgPSBDamtDb252LmNqazJ6aHModyk7XG5cblx0XHRcdGlmICh3MiAhPT0gdyAmJiAhdGhpcy5leGlzdHModzIpKVxuXHRcdFx0e1xuXHRcdFx0XHR0aGlzLl9hZGQoe3c6IHcyLCBwLCBmfSk7XG5cdFx0XHRcdC8vY29uc29sZS5sb2codzIpO1xuXHRcdFx0fVxuXHRcdFx0Ki9cblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdHByb3RlY3RlZCBfYWRkKHsgdywgcCwgZiwgcyB9OiB7XG5cdFx0dzogc3RyaW5nLFxuXHRcdHA6IG51bWJlcixcblx0XHRmOiBudW1iZXIsXG5cdFx0cz86IGJvb2xlYW4sXG5cdH0pXG5cdHtcblx0XHRsZXQgbGVuID0gdy5sZW5ndGg7XG5cblx0XHR0aGlzLlRBQkxFW3ddID0ge1xuXHRcdFx0cCxcblx0XHRcdGYsXG5cdFx0XHRzLFxuXHRcdH0gYXMgSVRhYmxlRGljdFJvdztcblxuXHRcdGlmICghdGhpcy5UQUJMRTJbbGVuXSkgdGhpcy5UQUJMRTJbbGVuXSA9IHt9O1xuXG5cdFx0dGhpcy5UQUJMRTJbbGVuXVt3XSA9IHRoaXMuVEFCTEVbd107XG5cdH1cblxuXHRyZW1vdmUodGFyZ2V0OiBJV29yZCB8IElEaWN0Um93IHwgc3RyaW5nKVxuXHR7XG5cdFx0bGV0IHsgZGF0YSwgcGx1cyB9ID0gdGhpcy5fX2hhbmRsZUlucHV0KHRhcmdldCk7XG5cblx0XHR0aGlzLl9yZW1vdmUoZGF0YSk7XG5cblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblx0cHJvdGVjdGVkIF9yZW1vdmUoeyB3LCBwLCBmLCBzIH06IElXb3JkKVxuXHR7XG5cdFx0bGV0IGxlbiA9IHcubGVuZ3RoO1xuXG5cdFx0ZGVsZXRlIHRoaXMuVEFCTEVbd107XG5cdFx0aWYgKHRoaXMuVEFCTEUyW2xlbl0pXG5cdFx0e1xuXHRcdFx0ZGVsZXRlIHRoaXMuVEFCTEUyW2xlbl1bd11cblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblx0anNvbigpOiBJRElDVDxJVGFibGVEaWN0Um93PlxuXHR7XG5cdFx0cmV0dXJuIGNsb25lRGVlcCh0aGlzLlRBQkxFKVxuXHR9XG5cblx0LyoqXG5cdCAqIOWwh+ebruWJjeeahCDooajmoLwg5Yyv5Ye6XG5cdCAqL1xuXHRzdHJpbmdpZnkoTEYgPSBcIlxcblwiKVxuXHR7XG5cdFx0bGV0IHNlbGYgPSB0aGlzO1xuXG5cdFx0cmV0dXJuIE9iamVjdC5lbnRyaWVzKHNlbGYuVEFCTEUpXG5cdFx0XHQucmVkdWNlKGZ1bmN0aW9uIChhLCBbdywgeyBwLCBmIH1dKVxuXHRcdFx0e1xuXHRcdFx0XHRsZXQgbGluZSA9IHN0cmluZ2lmeUxpbmUoW3csIHAsIGZdKTtcblxuXHRcdFx0XHRhLnB1c2gobGluZSk7XG5cblx0XHRcdFx0cmV0dXJuIGFcblx0XHRcdH0sIFtdKVxuXHRcdFx0LmpvaW4odHlwZW9mIExGID09PSAnc3RyaW5nJyA/IExGIDogXCJcXG5cIilcblx0XHRcdDtcblx0fVxufVxuXG5leHBvcnQgZGVmYXVsdCBUYWJsZURpY3RcbiJdfQ==