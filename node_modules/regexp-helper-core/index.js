"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.REGEXP_TO_STRING_TAG = Object.prototype.toString.call(/a/);
function toHex(n, toUpperCase) {
    let s = n.toString(16).padStart(4, '0');
    return toUpperCase ? s.toUpperCase() : s;
}
exports.toHex = toHex;
/**
 * @code
 * console.log(core.toUnicode('𠮷')); // => \u{20bb7}
 * console.log(core.toUnicode('𠮷'.codePointAt(0)));
 *
 * console.log(core.toUnicode('𠮷', true)); // => \ud842\udfb7
 * console.log(core.toUnicode('𠮷'.codePointAt(0), true));
 *
 * /[𠮷]/u.test('𠮷')
 * /[\u{20bb7}]/u.test('𠮷')
 * /[\ud842\udfb7]/u.test('𠮷')
 */
function toUnicode(charCode, noMerge, wrap) {
    let s;
    if (typeof charCode == 'string') {
        s = charCode;
        charCode = s.codePointAt(0);
    }
    if (charCode > 0xffff && noMerge) {
        let p;
        if (typeof s != 'string') {
            //s = String.fromCodePoint(charCode);
            p = surrogatePair(charCode);
        }
        else {
            p = [s.charCodeAt(0), s.charCodeAt(1)];
        }
        return p.map(function (n) {
            return _toUnicode(n, wrap);
        }).join('');
    }
    return _toUnicode(charCode, wrap);
}
exports.toUnicode = toUnicode;
function toUnicode2(charCode, options = {}) {
    return toUnicode(charCode, options.noMerge, options.wrap);
}
exports.toUnicode2 = toUnicode2;
function _toUnicode(charCode, wrap) {
    let hex = toHex(charCode);
    return (wrap || hex.length > 4) ? `\\u{${hex}}` : `\\u${hex}`;
}
exports._toUnicode = _toUnicode;
function isDoubleUnicode(str) {
    return str.charCodeAt(0) == str.codePointAt(0);
}
exports.isDoubleUnicode = isDoubleUnicode;
function isRegExp(r) {
    if ((r instanceof RegExp) || Object.prototype.toString.call(r) === exports.REGEXP_TO_STRING_TAG) {
        return r;
    }
    return null;
}
exports.isRegExp = isRegExp;
/**
 * @link https://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae
 * @link https://github.com/ikatyang/regexp-util/blob/7810ce61ff8becd728b745eb6d5c1ca76adfebe0/src/charset.ts#L289
 *
 * @code
 * surrogatePair('𠮷'.codePointAt(0)) // => { h: 55362, l: 57271 }
 * console.log('𠮷'.charCodeAt(0), '𠮷'.charCodeAt(1)) // => 55362 57271
 */
function surrogatePair(codepoint) {
    let h = Math.floor((codepoint - 0x10000) / 0x400) + 0xd800;
    let l = (codepoint - 0x10000) % 0x400 + 0xdc00;
    return Object.assign([h, l], {
        h,
        l,
    });
}
exports.surrogatePair = surrogatePair;
/**
 * https://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae
 *
 * @code
 * unicodeUnEscape('\\u{48}\\u{65}\\u{6c}\\u{6c}\\u{6f}\\u{20}\\u{77}\\u{6f}\\u{72}\\u{6c}\\u{64}') // => 'Hello world'
 * unicodeUnEscape('\\u{20bb7}') // => '𠮷'
 */
function unicodeUnEscape(string, noLeadingSolidus) {
    // note: this will match `u{123}` (no leading `\`) as well
    const r = noLeadingSolidus ? /u\{([0-9a-fA-F]{1,8})\}/g : /\\u\{([0-9a-fA-F]{1,8})\}/g;
    return string.replace(r, function ($0, $1) {
        return String.fromCodePoint(parseInt($1, 16));
    });
}
exports.unicodeUnEscape = unicodeUnEscape;
function unicodeUnEscape2(string, options = {}) {
    return unicodeUnEscape(string, options.noLeadingSolidus);
}
exports.unicodeUnEscape2 = unicodeUnEscape2;
/**
 * @code
 * unicodeEscape('𠮷') // => '\\u{20bb7}'
 */
function unicodeEscape(string, noLeadingSolidus, noMerge, noWrap, filter = /./ug) {
    return string.replace(filter, function ($0, $1) {
        let s = toUnicode($0, noMerge, !noWrap);
        return noLeadingSolidus ? s.replace(/\\/, '') : s;
    });
}
exports.unicodeEscape = unicodeEscape;
function unicodeEscape2(string, options = {}) {
    return unicodeEscape(string, options.noLeadingSolidus, options.noMerge, options.noWrap, options.filter);
}
exports.unicodeEscape2 = unicodeEscape2;
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}
exports.escapeRegExp = escapeRegExp;
exports.default = exports;
Object.freeze(exports);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFhLFFBQUEsb0JBQW9CLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBVyxDQUFDO0FBRWxGLFNBQWdCLEtBQUssQ0FBQyxDQUFTLEVBQUUsV0FBcUI7SUFFckQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3hDLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMxQyxDQUFDO0FBSkQsc0JBSUM7QUFFRDs7Ozs7Ozs7Ozs7R0FXRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxRQUF5QixFQUFFLE9BQWlCLEVBQUUsSUFBYztJQUVyRixJQUFJLENBQVMsQ0FBQztJQUVkLElBQUksT0FBTyxRQUFRLElBQUksUUFBUSxFQUMvQjtRQUNDLENBQUMsR0FBRyxRQUFRLENBQUM7UUFDYixRQUFRLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUM1QjtJQUVELElBQUksUUFBUSxHQUFHLE1BQU0sSUFBSSxPQUFPLEVBQ2hDO1FBQ0MsSUFBSSxDQUFXLENBQUM7UUFFaEIsSUFBSSxPQUFPLENBQUMsSUFBSSxRQUFRLEVBQ3hCO1lBQ0MscUNBQXFDO1lBQ3JDLENBQUMsR0FBRyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDNUI7YUFFRDtZQUNDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3ZDO1FBRUQsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLFVB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LElBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFeEMsT0FBTyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDLENBQUMsQ0FBQztBQUNKLENBQUM7QUFiRCxzQ0FhQztBQUVELFNBQWdCLGNBQWMsQ0FBQyxNQUFjLEVBQUUsVUFLM0MsRUFBRTtJQUVMLE9BQU8sYUFBYSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsT0FBTyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQTtBQUN4RyxDQUFDO0FBUkQsd0NBUUM7QUFFRCxTQUFnQixZQUFZLENBQUMsR0FBVztJQUV2QyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMscUJBQXFCLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUhELG9DQUdDO0FBRUQsa0JBQWUsT0FBNkMsQ0FBQTtBQUU1RCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IFJFR0VYUF9UT19TVFJJTkdfVEFHID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKC9hLykgYXMgc3RyaW5nO1xuXG5leHBvcnQgZnVuY3Rpb24gdG9IZXgobjogbnVtYmVyLCB0b1VwcGVyQ2FzZT86IGJvb2xlYW4pXG57XG5cdGxldCBzID0gbi50b1N0cmluZygxNikucGFkU3RhcnQoNCwgJzAnKTtcblx0cmV0dXJuIHRvVXBwZXJDYXNlID8gcy50b1VwcGVyQ2FzZSgpIDogcztcbn1cblxuLyoqXG4gKiBAY29kZVxuICogY29uc29sZS5sb2coY29yZS50b1VuaWNvZGUoJ/CgrrcnKSk7IC8vID0+IFxcdXsyMGJiN31cbiAqIGNvbnNvbGUubG9nKGNvcmUudG9Vbmljb2RlKCfwoK63Jy5jb2RlUG9pbnRBdCgwKSkpO1xuICpcbiAqIGNvbnNvbGUubG9nKGNvcmUudG9Vbmljb2RlKCfwoK63JywgdHJ1ZSkpOyAvLyA9PiBcXHVkODQyXFx1ZGZiN1xuICogY29uc29sZS5sb2coY29yZS50b1VuaWNvZGUoJ/CgrrcnLmNvZGVQb2ludEF0KDApLCB0cnVlKSk7XG4gKlxuICogL1vwoK63XS91LnRlc3QoJ/CgrrcnKVxuICogL1tcXHV7MjBiYjd9XS91LnRlc3QoJ/CgrrcnKVxuICogL1tcXHVkODQyXFx1ZGZiN10vdS50ZXN0KCfwoK63JylcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvVW5pY29kZShjaGFyQ29kZTogbnVtYmVyIHwgc3RyaW5nLCBub01lcmdlPzogYm9vbGVhbiwgd3JhcD86IGJvb2xlYW4pXG57XG5cdGxldCBzOiBzdHJpbmc7XG5cblx0aWYgKHR5cGVvZiBjaGFyQ29kZSA9PSAnc3RyaW5nJylcblx0e1xuXHRcdHMgPSBjaGFyQ29kZTtcblx0XHRjaGFyQ29kZSA9IHMuY29kZVBvaW50QXQoMCk7XG5cdH1cblxuXHRpZiAoY2hhckNvZGUgPiAweGZmZmYgJiYgbm9NZXJnZSlcblx0e1xuXHRcdGxldCBwOiBudW1iZXJbXTtcblxuXHRcdGlmICh0eXBlb2YgcyAhPSAnc3RyaW5nJylcblx0XHR7XG5cdFx0XHQvL3MgPSBTdHJpbmcuZnJvbUNvZGVQb2ludChjaGFyQ29kZSk7XG5cdFx0XHRwID0gc3Vycm9nYXRlUGFpcihjaGFyQ29kZSk7XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHRwID0gW3MuY2hhckNvZGVBdCgwKSwgcy5jaGFyQ29kZUF0KDEpXTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcC5tYXAoZnVuY3Rpb24gKG4pXG5cdFx0e1xuXHRcdFx0cmV0dXJuIF90b1VuaWNvZGUobiwgd3JhcCk7XG5cdFx0fSkuam9pbignJyk7XG5cdH1cblxuXHRyZXR1cm4gX3RvVW5pY29kZShjaGFyQ29kZSwgd3JhcCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1VuaWNvZGUyKGNoYXJDb2RlOiBudW1iZXIgfCBzdHJpbmcsIG9wdGlvbnM6IHtcblx0bm9NZXJnZT86IGJvb2xlYW4sXG5cdHdyYXA/OiBib29sZWFuXG59ID0ge30pXG57XG5cdHJldHVybiB0b1VuaWNvZGUoY2hhckNvZGUsIG9wdGlvbnMubm9NZXJnZSwgb3B0aW9ucy53cmFwKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gX3RvVW5pY29kZShjaGFyQ29kZTogbnVtYmVyLCB3cmFwPzogYm9vbGVhbilcbntcblx0bGV0IGhleCA9IHRvSGV4KGNoYXJDb2RlKTtcblx0cmV0dXJuICh3cmFwIHx8IGhleC5sZW5ndGggPiA0KSA/IGBcXFxcdXske2hleH19YCA6IGBcXFxcdSR7aGV4fWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0RvdWJsZVVuaWNvZGUoc3RyOiBzdHJpbmcpXG57XG5cdHJldHVybiBzdHIuY2hhckNvZGVBdCgwKSA9PSBzdHIuY29kZVBvaW50QXQoMCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1JlZ0V4cDxUIGV4dGVuZHMgUmVnRXhwPihyOiBUKTogVCAmIFJlZ0V4cFxuZXhwb3J0IGZ1bmN0aW9uIGlzUmVnRXhwKHI6IFJlZ0V4cCk6IHIgaXMgUmVnRXhwXG5leHBvcnQgZnVuY3Rpb24gaXNSZWdFeHAocik6IFJlZ0V4cCB8IG51bGxcbmV4cG9ydCBmdW5jdGlvbiBpc1JlZ0V4cChyKVxue1xuXHRpZiAoKHIgaW5zdGFuY2VvZiBSZWdFeHApIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChyKSA9PT0gUkVHRVhQX1RPX1NUUklOR19UQUcpXG5cdHtcblx0XHRyZXR1cm4gcjtcblx0fVxuXG5cdHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqIEBsaW5rIGh0dHBzOi8vbWF0aGlhc2J5bmVucy5iZS9ub3Rlcy9qYXZhc2NyaXB0LWVuY29kaW5nI3N1cnJvZ2F0ZS1mb3JtdWxhZVxuICogQGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL2lrYXR5YW5nL3JlZ2V4cC11dGlsL2Jsb2IvNzgxMGNlNjFmZjhiZWNkNzI4Yjc0NWViNmQ1YzFjYTc2YWRmZWJlMC9zcmMvY2hhcnNldC50cyNMMjg5XG4gKlxuICogQGNvZGVcbiAqIHN1cnJvZ2F0ZVBhaXIoJ/CgrrcnLmNvZGVQb2ludEF0KDApKSAvLyA9PiB7IGg6IDU1MzYyLCBsOiA1NzI3MSB9XG4gKiBjb25zb2xlLmxvZygn8KCutycuY2hhckNvZGVBdCgwKSwgJ/CgrrcnLmNoYXJDb2RlQXQoMSkpIC8vID0+IDU1MzYyIDU3MjcxXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdXJyb2dhdGVQYWlyKGNvZGVwb2ludDogbnVtYmVyKVxue1xuXHRsZXQgaCA9IE1hdGguZmxvb3IoKGNvZGVwb2ludCAtIDB4MTAwMDApIC8gMHg0MDApICsgMHhkODAwO1xuXHRsZXQgbCA9IChjb2RlcG9pbnQgLSAweDEwMDAwKSAlIDB4NDAwICsgMHhkYzAwO1xuXG5cdHJldHVybiBPYmplY3QuYXNzaWduKFtoLCBsXSBhcyBbbnVtYmVyLCBudW1iZXJdLCB7XG5cdFx0aCxcblx0XHRsLFxuXHR9KTtcbn1cblxuLyoqXG4gKiBodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvamF2YXNjcmlwdC1lbmNvZGluZyNzdXJyb2dhdGUtZm9ybXVsYWVcbiAqXG4gKiBAY29kZVxuICogdW5pY29kZVVuRXNjYXBlKCdcXFxcdXs0OH1cXFxcdXs2NX1cXFxcdXs2Y31cXFxcdXs2Y31cXFxcdXs2Zn1cXFxcdXsyMH1cXFxcdXs3N31cXFxcdXs2Zn1cXFxcdXs3Mn1cXFxcdXs2Y31cXFxcdXs2NH0nKSAvLyA9PiAnSGVsbG8gd29ybGQnXG4gKiB1bmljb2RlVW5Fc2NhcGUoJ1xcXFx1ezIwYmI3fScpIC8vID0+ICfwoK63J1xuICovXG5leHBvcnQgZnVuY3Rpb24gdW5pY29kZVVuRXNjYXBlKHN0cmluZzogc3RyaW5nLCBub0xlYWRpbmdTb2xpZHVzPzogYm9vbGVhbilcbntcblx0Ly8gbm90ZTogdGhpcyB3aWxsIG1hdGNoIGB1ezEyM31gIChubyBsZWFkaW5nIGBcXGApIGFzIHdlbGxcblx0Y29uc3QgciA9IG5vTGVhZGluZ1NvbGlkdXMgPyAvdVxceyhbMC05YS1mQS1GXXsxLDh9KVxcfS9nIDogL1xcXFx1XFx7KFswLTlhLWZBLUZdezEsOH0pXFx9L2c7XG5cblx0cmV0dXJuIHN0cmluZy5yZXBsYWNlKHIsIGZ1bmN0aW9uICgkMCwgJDEpXG5cdHtcblx0XHRyZXR1cm4gU3RyaW5nLmZyb21Db2RlUG9pbnQocGFyc2VJbnQoJDEsIDE2KSk7XG5cdH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5pY29kZVVuRXNjYXBlMihzdHJpbmc6IHN0cmluZywgb3B0aW9uczoge1xuXHRub0xlYWRpbmdTb2xpZHVzPzogYm9vbGVhbixcbn0gPSB7fSlcbntcblx0cmV0dXJuIHVuaWNvZGVVbkVzY2FwZShzdHJpbmcsIG9wdGlvbnMubm9MZWFkaW5nU29saWR1cylcbn1cblxuLyoqXG4gKiBAY29kZVxuICogdW5pY29kZUVzY2FwZSgn8KCutycpIC8vID0+ICdcXFxcdXsyMGJiN30nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bmljb2RlRXNjYXBlKHN0cmluZzogc3RyaW5nLFxuXHRub0xlYWRpbmdTb2xpZHVzPzogYm9vbGVhbixcblx0bm9NZXJnZT86IGJvb2xlYW4sXG5cdG5vV3JhcD86IGJvb2xlYW4sXG5cdGZpbHRlciA9IC8uL3VnXG4pXG57XG5cdHJldHVybiBzdHJpbmcucmVwbGFjZShmaWx0ZXIsIGZ1bmN0aW9uICgkMCwgJDEpXG5cdHtcblx0XHRsZXQgcyA9IHRvVW5pY29kZSgkMCwgbm9NZXJnZSwgIW5vV3JhcCk7XG5cblx0XHRyZXR1cm4gbm9MZWFkaW5nU29saWR1cyA/IHMucmVwbGFjZSgvXFxcXC8sICcnKSA6IHM7XG5cdH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5pY29kZUVzY2FwZTIoc3RyaW5nOiBzdHJpbmcsIG9wdGlvbnM6IHtcblx0bm9MZWFkaW5nU29saWR1cz86IGJvb2xlYW4sXG5cdG5vTWVyZ2U/OiBib29sZWFuLFxuXHRub1dyYXA/OiBib29sZWFuLFxuXHRmaWx0ZXI/OiBSZWdFeHBcbn0gPSB7fSlcbntcblx0cmV0dXJuIHVuaWNvZGVFc2NhcGUoc3RyaW5nLCBvcHRpb25zLm5vTGVhZGluZ1NvbGlkdXMsIG9wdGlvbnMubm9NZXJnZSwgb3B0aW9ucy5ub1dyYXAsIG9wdGlvbnMuZmlsdGVyKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZXNjYXBlUmVnRXhwKHN0cjogc3RyaW5nKVxue1xuXHRyZXR1cm4gc3RyLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCAnXFxcXCQmJyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGV4cG9ydHMgYXMgUmVhZG9ubHk8dHlwZW9mIGltcG9ydCgnLi9pbmRleCcpPlxuXG5PYmplY3QuZnJlZXplKGV4cG9ydHMpO1xuIl19