"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const legacyImpl = {
    at(s, end, i) {
        return i < end ? s.charCodeAt(i) : -1;
    },
    width(c) {
        return 1;
    },
};
const unicodeImpl = {
    at(s, end, i) {
        return i < end ? s.codePointAt(i) : -1;
    },
    width(c) {
        return c > 0xffff ? 2 : 1;
    },
};
class Reader {
    constructor() {
        this._impl = legacyImpl;
        this._s = "";
        this._i = 0;
        this._end = 0;
        this._cp1 = -1;
        this._w1 = 1;
        this._cp2 = -1;
        this._w2 = 1;
        this._cp3 = -1;
        this._w3 = 1;
        this._cp4 = -1;
    }
    get source() {
        return this._s;
    }
    get index() {
        return this._i;
    }
    get currentCodePoint() {
        return this._cp1;
    }
    get nextCodePoint() {
        return this._cp2;
    }
    get nextCodePoint2() {
        return this._cp3;
    }
    get nextCodePoint3() {
        return this._cp4;
    }
    reset(source, start, end, uFlag) {
        this._impl = uFlag ? unicodeImpl : legacyImpl;
        this._s = source;
        this._end = end;
        this.rewind(start);
    }
    rewind(index) {
        const impl = this._impl;
        this._i = index;
        this._cp1 = impl.at(this._s, this._end, index);
        this._w1 = impl.width(this._cp1);
        this._cp2 = impl.at(this._s, this._end, index + this._w1);
        this._w2 = impl.width(this._cp2);
        this._cp3 = impl.at(this._s, this._end, index + this._w1 + this._w2);
        this._w3 = impl.width(this._cp3);
        this._cp4 = impl.at(this._s, this._end, index + this._w1 + this._w2 + this._w3);
    }
    advance() {
        if (this._cp1 !== -1) {
            const impl = this._impl;
            this._i += this._w1;
            this._cp1 = this._cp2;
            this._w1 = this._w2;
            this._cp2 = this._cp3;
            this._w2 = impl.width(this._cp2);
            this._cp3 = this._cp4;
            this._w3 = impl.width(this._cp3);
            this._cp4 = impl.at(this._s, this._end, this._i + this._w1 + this._w2 + this._w3);
        }
    }
    eat(cp) {
        if (this._cp1 === cp) {
            this.advance();
            return true;
        }
        return false;
    }
    eat2(cp1, cp2) {
        if (this._cp1 === cp1 && this._cp2 === cp2) {
            this.advance();
            this.advance();
            return true;
        }
        return false;
    }
    eat3(cp1, cp2, cp3) {
        if (this._cp1 === cp1 && this._cp2 === cp2 && this._cp3 === cp3) {
            this.advance();
            this.advance();
            this.advance();
            return true;
        }
        return false;
    }
}
exports.Reader = Reader;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicmVhZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTSxVQUFVLEdBQUc7SUFDZixFQUFFLENBQUMsQ0FBUyxFQUFFLEdBQVcsRUFBRSxDQUFTO1FBQ2hDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDekMsQ0FBQztJQUNELEtBQUssQ0FBQyxDQUFTO1FBQ1gsT0FBTyxDQUFDLENBQUE7SUFDWixDQUFDO0NBQ0osQ0FBQTtBQUNELE1BQU0sV0FBVyxHQUFHO0lBQ2hCLEVBQUUsQ0FBQyxDQUFTLEVBQUUsR0FBVyxFQUFFLENBQVM7UUFDaEMsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUMzQyxDQUFDO0lBQ0QsS0FBSyxDQUFDLENBQVM7UUFDWCxPQUFPLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQzdCLENBQUM7Q0FDSixDQUFBO0FBRUQsTUFBYSxNQUFNO0lBQW5CO1FBQ1ksVUFBSyxHQUFHLFVBQVUsQ0FBQTtRQUNsQixPQUFFLEdBQUcsRUFBRSxDQUFBO1FBQ1AsT0FBRSxHQUFHLENBQUMsQ0FBQTtRQUNOLFNBQUksR0FBRyxDQUFDLENBQUE7UUFDUixTQUFJLEdBQVcsQ0FBQyxDQUFDLENBQUE7UUFDakIsUUFBRyxHQUFHLENBQUMsQ0FBQTtRQUNQLFNBQUksR0FBVyxDQUFDLENBQUMsQ0FBQTtRQUNqQixRQUFHLEdBQUcsQ0FBQyxDQUFBO1FBQ1AsU0FBSSxHQUFXLENBQUMsQ0FBQyxDQUFBO1FBQ2pCLFFBQUcsR0FBRyxDQUFDLENB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QUE7WUFDZCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUE7WUFDZCxPQUFPLElBQUksQ0FBQTtTQUNkO1FBQ0QsT0FBTyxLQUFLLENBQUE7SUFDaEIsQ0FBQztDQUNKO0FBN0dELHdCQTZHQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGxlZ2FjeUltcGwgPSB7XG4gICAgYXQoczogc3RyaW5nLCBlbmQ6IG51bWJlciwgaTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGkgPCBlbmQgPyBzLmNoYXJDb2RlQXQoaSkgOiAtMVxuICAgIH0sXG4gICAgd2lkdGgoYzogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIDFcbiAgICB9LFxufVxuY29uc3QgdW5pY29kZUltcGwgPSB7XG4gICAgYXQoczogc3RyaW5nLCBlbmQ6IG51bWJlciwgaTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIGkgPCBlbmQgPyBzLmNvZGVQb2ludEF0KGkpISA6IC0xXG4gICAgfSxcbiAgICB3aWR0aChjOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gYyA+IDB4ZmZmZiA/IDIgOiAxXG4gICAgfSxcbn1cblxuZXhwb3J0IGNsYXNzIFJlYWRlciB7XG4gICAgcHJpdmF0ZSBfaW1wbCA9IGxlZ2FjeUltcGxcbiAgICBwcml2YXRlIF9zID0gXCJcIlxuICAgIHByaXZhdGUgX2kgPSAwXG4gICAgcHJpdmF0ZSBfZW5kID0gMFxuICAgIHByaXZhdGUgX2NwMTogbnVtYmVyID0gLTFcbiAgICBwcml2YXRlIF93MSA9IDFcbiAgICBwcml2YXRlIF9jcDI6IG51bWJlciA9IC0xXG4gICAgcHJpdmF0ZSBfdzIgPSAxXG4gICAgcHJpdmF0ZSBfY3AzOiBudW1iZXIgPSAtMVxuICAgIHByaXZhdGUgX3czID0gMVxuICAgIHByaXZhdGUgX2NwNDogbnVtYmVyID0gLTFcblxuICAgIHB1YmxpYyBnZXQgc291cmNlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zXG4gICAgfVxuXG4gICAgcHVibGljIGdldCBpbmRleCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5faVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgY3VycmVudENvZGVQb2ludCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fY3AxXG4gICAgfVxuXG4gICAgcHVibGljIGdldCBuZXh0Q29kZVBvaW50KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jcDJcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IG5leHRDb2RlUG9pbnQyKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jcDNcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IG5leHRDb2RlUG9pbnQzKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jcDRcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzZXQoXG4gICAgICAgIHNvdXJjZTogc3RyaW5nLFxuICAgICAgICBzdGFydDogbnVtYmVyLFxuICAgICAgICBlbmQ6IG51bWJlcixcbiAgICAgICAgdUZsYWc6IGJvb2xlYW4sXG4gICAgKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2ltcGwgPSB1RmxhZyA/IHVuaWNvZGVJbXBsIDogbGVnYWN5SW1wbFxuICAgICAgICB0aGlzLl9zID0gc291cmNlXG4gICAgICAgIHRoaXMuX2VuZCA9IGVuZFxuICAgICAgICB0aGlzLnJld2luZChzdGFydClcbiAgICB9XG5cbiAgICBwdWJsaWMgcmV3aW5kKGluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaW1wbCA9IHRoaXMuX2ltcGxcbiAgICAgICAgdGhpcy5faSA9IGluZGV4XG4gICAgICAgIHRoaXMuX2NwMSA9IGltcGwuYXQodGhpcy5fcywgdGhpcy5fZW5kLCBpbmRleClcbiAgICAgICAgdGhpcy5fdzEgPSBpbXBsLndpZHRoKHRoaXMuX2NwMSlcbiAgICAgICAgdGhpcy5fY3AyID0gaW1wbC5hdCh0aGlzLl9zLCB0aGlzLl9lbmQsIGluZGV4ICsgdGhpcy5fdzEpXG4gICAgICAgIHRoaXMuX3cyID0gaW1wbC53aWR0aCh0aGlzLl9jcDIpXG4gICAgICAgIHRoaXMuX2NwMyA9IGltcGwuYXQodGhpcy5fcywgdGhpcy5fZW5kLCBpbmRleCArIHRoaXMuX3cxICsgdGhpcy5fdzIpXG4gICAgICAgIHRoaXMuX3czID0gaW1wbC53aWR0aCh0aGlzLl9jcDMpXG4gICAgICAgIHRoaXMuX2NwNCA9IGltcGwuYXQoXG4gICAgICAgICAgICB0aGlzLl9zLFxuICAgICAgICAgICAgdGhpcy5fZW5kLFxuICAgICAgICAgICAgaW5kZXggKyB0aGlzLl93MSArIHRoaXMuX3cyICsgdGhpcy5fdzMsXG4gICAgICAgIClcbiAgICB9XG5cbiAgICBwdWJsaWMgYWR2YW5jZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuX2NwMSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGNvbnN0IGltcGwgPSB0aGlzLl9pbXBsXG4gICAgICAgICAgICB0aGlzLl9pICs9IHRoaXMuX3cxXG4gICAgICAgICAgICB0aGlzLl9jcDEgPSB0aGlzLl9jcDJcbiAgICAgICAgICAgIHRoaXMuX3cxID0gdGhpcy5fdzJcbiAgICAgICAgICAgIHRoaXMuX2NwMiA9IHRoaXMuX2NwM1xuICAgICAgICAgICAgdGhpcy5fdzIgPSBpbXBsLndpZHRoKHRoaXMuX2NwMilcbiAgICAgICAgICAgIHRoaXMuX2NwMyA9IHRoaXMuX2NwNFxuICAgICAgICAgICAgdGhpcy5fdzMgPSBpbXBsLndpZHRoKHRoaXMuX2NwMylcbiAgICAgICAgICAgIHRoaXMuX2NwNCA9IGltcGwuYXQoXG4gICAgICAgICAgICAgICAgdGhpcy5fcyxcbiAgICAgICAgICAgICAgICB0aGlzLl9lbmQsXG4gICAgICAgICAgICAgICAgdGhpcy5faSArIHRoaXMuX3cxICsgdGhpcy5fdzIgKyB0aGlzLl93MyxcbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBlYXQoY3A6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5fY3AxID09PSBjcCkge1xuICAgICAgICAgICAgdGhpcy5hZHZhbmNlKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgcHVibGljIGVhdDIoY3AxOiBudW1iZXIsIGNwMjogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLl9jcDEgPT09IGNwMSAmJiB0aGlzLl9jcDIgPT09IGNwMikge1xuICAgICAgICAgICAgdGhpcy5hZHZhbmNlKClcbiAgICAgICAgICAgIHRoaXMuYWR2YW5jZSgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHB1YmxpYyBlYXQzKGNwMTogbnVtYmVyLCBjcDI6IG51bWJlciwgY3AzOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuX2NwMSA9PT0gY3AxICYmIHRoaXMuX2NwMiA9PT0gY3AyICYmIHRoaXMuX2NwMyA9PT0gY3AzKSB7XG4gICAgICAgICAgICB0aGlzLmFkdmFuY2UoKVxuICAgICAgICAgICAgdGhpcy5hZHZhbmNlKClcbiAgICAgICAgICAgIHRoaXMuYWR2YW5jZSgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbn1cbiJdfQ==