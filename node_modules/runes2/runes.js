'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.HIGH_SURROGATE_START = 0xd800;
exports.HIGH_SURROGATE_END = 0xdbff;
exports.LOW_SURROGATE_START = 0xdc00;
exports.REGIONAL_INDICATOR_START = 0x1f1e6;
exports.REGIONAL_INDICATOR_END = 0x1f1ff;
exports.FITZPATRICK_MODIFIER_START = 0x1f3fb;
exports.FITZPATRICK_MODIFIER_END = 0x1f3ff;
exports.VARIATION_MODIFIER_START = 0xfe00;
exports.VARIATION_MODIFIER_END = 0xfe0f;
exports.DIACRITICAL_MARKS_START = 0x20d0;
exports.DIACRITICAL_MARKS_END = 0x20ff;
exports.ZWJ = 0x200d;
exports.GRAPHEMS = [
    0x0308,
    0x0937,
    0x0937,
    0x093F,
    0x093F,
    0x0BA8,
    0x0BBF,
    0x0BCD,
    0x0E31,
    0x0E33,
    0x0E40,
    0x0E49,
    0x1100,
    0x1161,
    0x11A8,
];
function runes(string) {
    if (typeof string !== 'string') {
        throw new Error('string cannot be undefined or null');
    }
    const result = [];
    let i = 0;
    let increment = 0;
    while (i < string.length) {
        increment += nextUnits(i + increment, string);
        if (isGraphem(string[i + increment])) {
            increment++;
        }
        if (isVariationSelector(string[i + increment])) {
            increment++;
        }
        if (isDiacriticalMark(string[i + increment])) {
            increment++;
        }
        if (isZeroWidthJoiner(string[i + increment])) {
            increment++;
            continue;
        }
        result.push(string.substring(i, i + increment));
        i += increment;
        increment = 0;
    }
    return result;
}
exports.runes = runes;
// Decide how many code units make up the current character.
// BMP characters: 1 code unit
// Non-BMP characters (represented by surrogate pairs): 2 code units
// Emoji with skin-tone modifiers: 4 code units (2 code points)
// Country flags: 4 code units (2 code points)
// Variations: 2 code units
function nextUnits(i, string) {
    const current = string[i];
    // If we don't have a value that is part of a surrogate pair, or we're at
    // the end, only take the value at i
    if (!isFirstOfSurrogatePair(current) || i === string.length - 1) {
        return 1;
    }
    const currentPair = current + string[i + 1];
    let nextPair = string.substring(i + 2, i + 5);
    // Country flags are comprised of two regional indicator symbols,
    // each represented by a surrogate pair.
    // See http://emojipedia.org/flags/
    // If both pairs are regional indicator symbols, take 4
    if (isRegionalIndicator(currentPair) && isRegionalIndicator(nextPair)) {
        return 4;
    }
    // If the next pair make a Fitzpatrick skin tone
    // modifier, take 4
    // See http://emojipedia.org/modifiers/
    // Technically, only some code points are meant to be
    // combined with the skin tone modifiers. This function
    // does not check the current pair to see if it is
    // one of them.
    if (isFitzpatrickModifier(nextPair)) {
        return 4;
    }
    return 2;
}
exports.nextUnits = nextUnits;
function isFirstOfSurrogatePair(string) {
    return string && betweenInclusive(string[0].charCodeAt(0), exports.HIGH_SURROGATE_START, exports.HIGH_SURROGATE_END);
}
exports.isFirstOfSurrogatePair = isFirstOfSurrogatePair;
function isRegionalIndicator(string) {
    return betweenInclusive(codePointFromSurrogatePair(string), exports.REGIONAL_INDICATOR_START, exports.REGIONAL_INDICATOR_END);
}
exports.isRegionalIndicator = isRegionalIndicator;
function isFitzpatrickModifier(string) {
    return betweenInclusive(codePointFromSurrogatePair(string), exports.FITZPATRICK_MODIFIER_START, exports.FITZPATRICK_MODIFIER_END);
}
exports.isFitzpatrickModifier = isFitzpatrickModifier;
function isVariationSelector(string) {
    return typeof string === 'string' && betweenInclusive(string.charCodeAt(0), exports.VARIATION_MODIFIER_START, exports.VARIATION_MODIFIER_END);
}
exports.isVariationSelector = isVariationSelector;
function isDiacriticalMark(string) {
    return typeof string === 'string' && betweenInclusive(string.charCodeAt(0), exports.DIACRITICAL_MARKS_START, exports.DIACRITICAL_MARKS_END);
}
exports.isDiacriticalMark = isDiacriticalMark;
function isGraphem(string) {
    return typeof string === 'string' && exports.GRAPHEMS.indexOf(string.charCodeAt(0)) !== -1;
}
exports.isGraphem = isGraphem;
function isZeroWidthJoiner(string) {
    return typeof string === 'string' && string.charCodeAt(0) === exports.ZWJ;
}
exports.isZeroWidthJoiner = isZeroWidthJoiner;
function codePointFromSurrogatePair(pair) {
    const highOffset = pair.charCodeAt(0) - exports.HIGH_SURROGATE_START;
    const lowOffset = pair.charCodeAt(1) - exports.LOW_SURROGATE_START;
    return (highOffset << 10) + lowOffset + 0x10000;
}
exports.codePointFromSurrogatePair = codePointFromSurrogatePair;
function betweenInclusive(value, lower, upper) {
    return value >= lower && value <= upper;
}
exports.betweenInclusive = betweenInclusive;
function substring(string, start, width) {
    const chars = runes(string);
    if (start === undefined) {
        return string;
    }
    if (start >= chars.length) {
        return '';
    }
    const rest = chars.length - start;
    const stringWidth = width === undefined ? rest : width;
    let endIndex = start + stringWidth;
    if (endIndex > (start + rest)) {
        endIndex = undefined;
    }
    return chars.slice(start, endIndex).join('');
}
exports.substring = substring;
exports.substr = substring;
runes.substr = substring;
runes.substring = substring;
runes.default = runes;
runes.runes = runes;
Object.defineProperty(runes, "__esModule", { value: true });
exports.default = runes;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVuZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJydW5lcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUE7O0FBRUMsUUFBQSxvQkFBb0IsR0FBRyxNQUFNLENBQUE7QUFDN0IsUUFBQSxrQkFBa0IsR0FBRyxNQUFNLENBQUE7QUFFM0IsUUFBQSxtQkFBbUIsR0FBRyxNQUFNLENBQUE7QUFFNUIsUUFBQSx3QkFBd0IsR0FBRyxPQUFPLENBQUE7QUFDbEMsUUFBQSxzQkFBc0IsR0FBRyxPQUFPLENBQUE7QUFFaEMsUUFBQSwwQkFBMEIsR0FBRyxPQUFPLENBQUE7QUFDcEMsUUFBQSx3QkFBd0IsR0FBRyxPQUFPLENBQUE7QUFFbEMsUUFBQSx3QkFBd0IsR0FBRyxNQUFNLENBQUE7QUFDakMsUUFBQSxzQkFBc0IsR0FBRyxNQUFNLENBQUE7QUFFL0IsUUFBQSx1QkFBdUIsR0FBRyxNQUFNLENBQUE7QUFDaEMsUUFBQSxxQkFBcUIsR0FBRyxNQUFNLENBQUE7QUFFOUIsUUFBQSxHQUFHLEdBQUcsTUFBTSxDQUFBO0FBRVosUUFBQSxRQUFRLEdBQUc7SUFDdkIsTUFBTTtJQUNOLE1BQU07SUFDTixNQUFNO0lBQ04sTUFBTTtJQUNOLE1BQU07SUFDTixNQUFNO0lBQ04sTUFBTTtJQUNOLE1BQU07SUFDTixNQUFNO0lBQ04sTUFBTTtJQUNOLE1BQU07SUFDTixNQUFNO0lBQ04sTUFBTTtJQUNOLE1BQU07SUFDTixNQUFNO0NBQ04sQ0FBQTtBQUVELFNBQWdCLEtBQUssQ0FBQyxNQUFjO0lBRW5DLElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxFQUM5QjtRQUNDLE1BQU0sSUFBSSxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQTtLQUNyRDtJQUNELE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUNqQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDVCxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUE7SUFDakIsT0FBTyxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFDeEI7UUFDQyxTQUFTLElBQUksU0FBUyxDQUFDLENBQUMsR0FBRyxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDN0MsSUFBSSxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxFQUNwQztZQUNDLFNBQVMsRUFBRSxDQUFBO1NBQ1g7UUFDRCxJQUFJLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsRUFDOUM7WUFDQyxTQUFTLEVBQUUsQ0FBQTtTQUNYO1FBQ0QsSUFBSSxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFDLEVBQzVDO1lBQ0MsU0FBUyxFQUFFLENBQUE7U0FDWDtRQUNELElBQUksaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxFQUM1QztZQUNDLFNBQVMsRUFBRSxDQUFBO1lBQ1gsU0FBUTtTQUNSO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQTtRQUMvQyxDQUFDLElBQUksU0FBUyxDQUFBO1FBQ2QsU0FBUyxHQUFHLENBQUMsQ0FBQTtLQUNiO0lBQ0QsT0FBTyxNQUFNLENBQUE7QUFDZCxDQUFDO0FBbENELHNCQWtDQztBQUVELDREQUE0RDtBQUM1RCw4QkFBOEI7QUFDOUIsb0VBQW9FO0FBQ3BFLCtEQUErRDtBQUMvRCw4Q0FBOEM7QUFDOUMsMkJBQTJCO0FBQzNCLFNBQWdCLFNBQVMsQ0FBQyxDQUFTLEVBQUUsTUFBYztJQUVsRCxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDekIseUVBQXlFO0lBQ3pFLG9DQUFvQztJQUNwQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUMvRDtRQUNDLE9BQU8sQ0FBQyxDQUFBO0tBQ1I7SUFFRCxNQUFNLFdBQVcsR0FBRyxPQUFPLEdBQUcsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUMzQyxJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRTdDLGlFQUFpRTtJQUNqRSx3Q0FBd0M7SUFDeEMsbUNBQW1DO0lBQ25DLHVEQUF1RDtJQUN2RCxJQUFJLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxJQUFJLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxFQUNyRTtRQUNDLE9BQU8sQ0FBQyxDQUFBO0tBQ1I7SUFFRCxnREFBZ0Q7SUFDaEQsbUJBQW1CO0lBQ25CLHVDQUF1QztJQUN2QyxxREFBcUQ7SUFDckQsdURBQXVEO0lBQ3ZELGtEQUFrRDtJQUNsRCxlQUFlO0lBQ2YsSUFBSSxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsRUFDbkM7UUFDQyxPQUFPLENBQUMsQ0FBQTtLQUNSO0lBQ0QsT0FBTyxDQUFDLENBQUE7QUFDVCxDQUFDO0FBbENELDhCQWtDQztBQUVELFNBQWdCLHNCQUFzQixDQUFDLE1BQWM7SUFFcEQsT0FBTyxNQUFNLElBQUksZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSw0QkFBb0IsRUFBRSwwQkFBa0IsQ0FBQyxDQUFBO0FBQ3JHLENBQUM7QUFIRCx3REFHQztBQUVELFNBQWdCLG1CQUFtQixDQUFDLE1BQWM7SUFFakQsT0FBTyxnQkFBZ0IsQ0FBQywwQkFBMEIsQ0FBQyxNQUFNLENBQUMsRUFBRSxnQ0FBd0IsRUFBRSw4QkFBc0IsQ0FBQyxDQUFBO0FBQzlHLENBQUM7QUFIRCxrREFHQztBQUVELFNBQWdCLHFCQUFxQixDQUFDLE1BQWM7SUFFbkQsT0FBTyxnQkFBZ0IsQ0FBQywwQkFBMEIsQ0FBQyxNQUFNLENBQUMsRUFBRSxrQ0FBMEIsRUFBRSxnQ0FBd0IsQ0FBQyxDQUFBO0FBQ2xILENBQUM7QUFIRCxzREFHQztBQUVELFNBQWdCLG1CQUFtQixDQUFDLE1BQWM7SUFFakQsT0FBTyxPQUFPLE1BQU0sS0FBSyxRQUFRLElBQUksZ0JBQWdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxnQ0FBd0IsRUFBRSw4QkFBc0IsQ0FBQyxDQUFBO0FBQzlILENBQUM7QUFIRCxrREFHQztBQUVELFNBQWdCLGlCQUFpQixDQUFDLE1BQWM7SUFFL0MsT0FBTyxPQUFPLE1BQU0sS0FBSyxRQUFRLElBQUksZ0JBQWdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSwrQkFBdUIsRUFBRSw2QkFBcUIsQ0FBQyxDQUFBO0FBQzVILENBQUM7QUFIRCw4Q0FHQztBQUVELFNBQWdCLFNBQVMsQ0FBQyxNQUFjO0lBRXZDLE9BQU8sT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLGdCQUFRLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtBQUNuRixDQUFDO0FBSEQsOEJBR0M7QUFFRCxTQUFnQixpQkFBaUIsQ0FBQyxNQUFjO0lBRS9DLE9BQU8sT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssV0FBRyxDQUFBO0FBQ2xFLENBQUM7QUFIRCw4Q0FHQztBQUVELFNBQWdCLDBCQUEwQixDQUFDLElBQVk7SUFFdEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyw0QkFBb0IsQ0FBQTtJQUM1RCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLDJCQUFtQixDQUFBO0lBQzFELE9BQU8sQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDLEdBQUcsU0FBUyxHQUFHLE9BQU8sQ0FBQTtBQUNoRCxDQUFDO0FBTEQsZ0VBS0M7QUFFRCxTQUFnQixnQkFBZ0IsQ0FBQyxLQUFhLEVBQUUsS0FBYSxFQUFFLEtBQWE7SUFFM0UsT0FBTyxLQUFLLElBQUksS0FBSyxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUE7QUFDeEMsQ0FBQztBQUhELDRDQUdDO0FBRUQsU0FBZ0IsU0FBUyxDQUFDLE1BQWMsRUFBRSxLQUFhLEVBQUUsS0FBYztJQUV0RSxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDM0IsSUFBSSxLQUFLLEtBQUssU0FBUyxFQUN2QjtRQUNDLE9BQU8sTUFBTSxDQUFBO0tBQ2I7SUFDRCxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxFQUN6QjtRQUNDLE9BQU8sRUFBRSxDQUFBO0tBQ1Q7SUFDRCxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQTtJQUNqQyxNQUFNLFdBQVcsR0FBRyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQTtJQUN0RCxJQUFJLFFBQVEsR0FBRyxLQUFLLEdBQUcsV0FBVyxDQUFBO0lBQ2xDLElBQUksUUFBUSxHQUFHLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxFQUM3QjtRQUNDLFFBQVEsR0FBRyxTQUFTLENBQUE7S0FDcEI7SUFDRCxPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUM3QyxDQUFDO0FBbkJELDhCQW1CQztBQUVZLFFBQUEsTUFBTSxHQUFHLFNBQVMsQ0FBQTtBQUUvQixLQUFLLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztBQUN6QixLQUFLLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztBQUU1QixLQUFLLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztBQUN0QixLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztBQUVwQixNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxZQUFZLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUU1RCxrQkFBZSxLQUFLLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcblxuZXhwb3J0IGNvbnN0IEhJR0hfU1VSUk9HQVRFX1NUQVJUID0gMHhkODAwXG5leHBvcnQgY29uc3QgSElHSF9TVVJST0dBVEVfRU5EID0gMHhkYmZmXG5cbmV4cG9ydCBjb25zdCBMT1dfU1VSUk9HQVRFX1NUQVJUID0gMHhkYzAwXG5cbmV4cG9ydCBjb25zdCBSRUdJT05BTF9JTkRJQ0FUT1JfU1RBUlQgPSAweDFmMWU2XG5leHBvcnQgY29uc3QgUkVHSU9OQUxfSU5ESUNBVE9SX0VORCA9IDB4MWYxZmZcblxuZXhwb3J0IGNvbnN0IEZJVFpQQVRSSUNLX01PRElGSUVSX1NUQVJUID0gMHgxZjNmYlxuZXhwb3J0IGNvbnN0IEZJVFpQQVRSSUNLX01PRElGSUVSX0VORCA9IDB4MWYzZmZcblxuZXhwb3J0IGNvbnN0IFZBUklBVElPTl9NT0RJRklFUl9TVEFSVCA9IDB4ZmUwMFxuZXhwb3J0IGNvbnN0IFZBUklBVElPTl9NT0RJRklFUl9FTkQgPSAweGZlMGZcblxuZXhwb3J0IGNvbnN0IERJQUNSSVRJQ0FMX01BUktTX1NUQVJUID0gMHgyMGQwXG5leHBvcnQgY29uc3QgRElBQ1JJVElDQUxfTUFSS1NfRU5EID0gMHgyMGZmXG5cbmV4cG9ydCBjb25zdCBaV0ogPSAweDIwMGRcblxuZXhwb3J0IGNvbnN0IEdSQVBIRU1TID0gW1xuXHQweDAzMDgsIC8vICgg4peMzIggKSBDT01CSU5JTkcgRElBRVJFU0lTXG5cdDB4MDkzNywgLy8gKCDgpLcgKSBERVZBTkFHQVJJIExFVFRFUiBTU0Fcblx0MHgwOTM3LCAvLyAoIOCktyApIERFVkFOQUdBUkkgTEVUVEVSIFNTQVxuXHQweDA5M0YsIC8vICgg4KS/ICkgREVWQU5BR0FSSSBWT1dFTCBTSUdOIElcblx0MHgwOTNGLCAvLyAoIOCkvyApIERFVkFOQUdBUkkgVk9XRUwgU0lHTiBJXG5cdDB4MEJBOCwgLy8gKCDgrqggKSBUQU1JTCBMRVRURVIgTkFcblx0MHgwQkJGLCAvLyAoIOCuvyApIFRBTUlMIFZPV0VMIFNJR04gSVxuXHQweDBCQ0QsIC8vICgg4peM4K+NKSBUQU1JTCBTSUdOIFZJUkFNQVxuXHQweDBFMzEsIC8vICgg4peM4LixICkgVEhBSSBDSEFSQUNURVIgTUFJIEhBTi1BS0FUXG5cdDB4MEUzMywgLy8gKCDguLMgKSBUSEFJIENIQVJBQ1RFUiBTQVJBIEFNXG5cdDB4MEU0MCwgLy8gKCDguYAgKSBUSEFJIENIQVJBQ1RFUiBTQVJBIEVcblx0MHgwRTQ5LCAvLyAoIOC5gCApIFRIQUkgQ0hBUkFDVEVSIE1BSSBUSE9cblx0MHgxMTAwLCAvLyAoIOGEgCApIEhBTkdVTCBDSE9TRU9ORyBLSVlFT0tcblx0MHgxMTYxLCAvLyAoIOGFoSApIEhBTkdVTCBKVU5HU0VPTkcgQVxuXHQweDExQTgsIC8vICgg4YaoICkgSEFOR1VMIEpPTkdTRU9ORyBLSVlFT0tcbl1cblxuZXhwb3J0IGZ1bmN0aW9uIHJ1bmVzKHN0cmluZzogc3RyaW5nKTogc3RyaW5nW11cbntcblx0aWYgKHR5cGVvZiBzdHJpbmcgIT09ICdzdHJpbmcnKVxuXHR7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdzdHJpbmcgY2Fubm90IGJlIHVuZGVmaW5lZCBvciBudWxsJylcblx0fVxuXHRjb25zdCByZXN1bHQgPSBbXVxuXHRsZXQgaSA9IDBcblx0bGV0IGluY3JlbWVudCA9IDBcblx0d2hpbGUgKGkgPCBzdHJpbmcubGVuZ3RoKVxuXHR7XG5cdFx0aW5jcmVtZW50ICs9IG5leHRVbml0cyhpICsgaW5jcmVtZW50LCBzdHJpbmcpXG5cdFx0aWYgKGlzR3JhcGhlbShzdHJpbmdbaSArIGluY3JlbWVudF0pKVxuXHRcdHtcblx0XHRcdGluY3JlbWVudCsrXG5cdFx0fVxuXHRcdGlmIChpc1ZhcmlhdGlvblNlbGVjdG9yKHN0cmluZ1tpICsgaW5jcmVtZW50XSkpXG5cdFx0e1xuXHRcdFx0aW5jcmVtZW50Kytcblx0XHR9XG5cdFx0aWYgKGlzRGlhY3JpdGljYWxNYXJrKHN0cmluZ1tpICsgaW5jcmVtZW50XSkpXG5cdFx0e1xuXHRcdFx0aW5jcmVtZW50Kytcblx0XHR9XG5cdFx0aWYgKGlzWmVyb1dpZHRoSm9pbmVyKHN0cmluZ1tpICsgaW5jcmVtZW50XSkpXG5cdFx0e1xuXHRcdFx0aW5jcmVtZW50Kytcblx0XHRcdGNvbnRpbnVlXG5cdFx0fVxuXHRcdHJlc3VsdC5wdXNoKHN0cmluZy5zdWJzdHJpbmcoaSwgaSArIGluY3JlbWVudCkpXG5cdFx0aSArPSBpbmNyZW1lbnRcblx0XHRpbmNyZW1lbnQgPSAwXG5cdH1cblx0cmV0dXJuIHJlc3VsdFxufVxuXG4vLyBEZWNpZGUgaG93IG1hbnkgY29kZSB1bml0cyBtYWtlIHVwIHRoZSBjdXJyZW50IGNoYXJhY3Rlci5cbi8vIEJNUCBjaGFyYWN0ZXJzOiAxIGNvZGUgdW5pdFxuLy8gTm9uLUJNUCBjaGFyYWN0ZXJzIChyZXByZXNlbnRlZCBieSBzdXJyb2dhdGUgcGFpcnMpOiAyIGNvZGUgdW5pdHNcbi8vIEVtb2ppIHdpdGggc2tpbi10b25lIG1vZGlmaWVyczogNCBjb2RlIHVuaXRzICgyIGNvZGUgcG9pbnRzKVxuLy8gQ291bnRyeSBmbGFnczogNCBjb2RlIHVuaXRzICgyIGNvZGUgcG9pbnRzKVxuLy8gVmFyaWF0aW9uczogMiBjb2RlIHVuaXRzXG5leHBvcnQgZnVuY3Rpb24gbmV4dFVuaXRzKGk6IG51bWJlciwgc3RyaW5nOiBzdHJpbmcpXG57XG5cdGNvbnN0IGN1cnJlbnQgPSBzdHJpbmdbaV1cblx0Ly8gSWYgd2UgZG9uJ3QgaGF2ZSBhIHZhbHVlIHRoYXQgaXMgcGFydCBvZiBhIHN1cnJvZ2F0ZSBwYWlyLCBvciB3ZSdyZSBhdFxuXHQvLyB0aGUgZW5kLCBvbmx5IHRha2UgdGhlIHZhbHVlIGF0IGlcblx0aWYgKCFpc0ZpcnN0T2ZTdXJyb2dhdGVQYWlyKGN1cnJlbnQpIHx8IGkgPT09IHN0cmluZy5sZW5ndGggLSAxKVxuXHR7XG5cdFx0cmV0dXJuIDFcblx0fVxuXG5cdGNvbnN0IGN1cnJlbnRQYWlyID0gY3VycmVudCArIHN0cmluZ1tpICsgMV1cblx0bGV0IG5leHRQYWlyID0gc3RyaW5nLnN1YnN0cmluZyhpICsgMiwgaSArIDUpXG5cblx0Ly8gQ291bnRyeSBmbGFncyBhcmUgY29tcHJpc2VkIG9mIHR3byByZWdpb25hbCBpbmRpY2F0b3Igc3ltYm9scyxcblx0Ly8gZWFjaCByZXByZXNlbnRlZCBieSBhIHN1cnJvZ2F0ZSBwYWlyLlxuXHQvLyBTZWUgaHR0cDovL2Vtb2ppcGVkaWEub3JnL2ZsYWdzL1xuXHQvLyBJZiBib3RoIHBhaXJzIGFyZSByZWdpb25hbCBpbmRpY2F0b3Igc3ltYm9scywgdGFrZSA0XG5cdGlmIChpc1JlZ2lvbmFsSW5kaWNhdG9yKGN1cnJlbnRQYWlyKSAmJiBpc1JlZ2lvbmFsSW5kaWNhdG9yKG5leHRQYWlyKSlcblx0e1xuXHRcdHJldHVybiA0XG5cdH1cblxuXHQvLyBJZiB0aGUgbmV4dCBwYWlyIG1ha2UgYSBGaXR6cGF0cmljayBza2luIHRvbmVcblx0Ly8gbW9kaWZpZXIsIHRha2UgNFxuXHQvLyBTZWUgaHR0cDovL2Vtb2ppcGVkaWEub3JnL21vZGlmaWVycy9cblx0Ly8gVGVjaG5pY2FsbHksIG9ubHkgc29tZSBjb2RlIHBvaW50cyBhcmUgbWVhbnQgdG8gYmVcblx0Ly8gY29tYmluZWQgd2l0aCB0aGUgc2tpbiB0b25lIG1vZGlmaWVycy4gVGhpcyBmdW5jdGlvblxuXHQvLyBkb2VzIG5vdCBjaGVjayB0aGUgY3VycmVudCBwYWlyIHRvIHNlZSBpZiBpdCBpc1xuXHQvLyBvbmUgb2YgdGhlbS5cblx0aWYgKGlzRml0enBhdHJpY2tNb2RpZmllcihuZXh0UGFpcikpXG5cdHtcblx0XHRyZXR1cm4gNFxuXHR9XG5cdHJldHVybiAyXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0ZpcnN0T2ZTdXJyb2dhdGVQYWlyKHN0cmluZzogc3RyaW5nKVxue1xuXHRyZXR1cm4gc3RyaW5nICYmIGJldHdlZW5JbmNsdXNpdmUoc3RyaW5nWzBdLmNoYXJDb2RlQXQoMCksIEhJR0hfU1VSUk9HQVRFX1NUQVJULCBISUdIX1NVUlJPR0FURV9FTkQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1JlZ2lvbmFsSW5kaWNhdG9yKHN0cmluZzogc3RyaW5nKVxue1xuXHRyZXR1cm4gYmV0d2VlbkluY2x1c2l2ZShjb2RlUG9pbnRGcm9tU3Vycm9nYXRlUGFpcihzdHJpbmcpLCBSRUdJT05BTF9JTkRJQ0FUT1JfU1RBUlQsIFJFR0lPTkFMX0lORElDQVRPUl9FTkQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0ZpdHpwYXRyaWNrTW9kaWZpZXIoc3RyaW5nOiBzdHJpbmcpXG57XG5cdHJldHVybiBiZXR3ZWVuSW5jbHVzaXZlKGNvZGVQb2ludEZyb21TdXJyb2dhdGVQYWlyKHN0cmluZyksIEZJVFpQQVRSSUNLX01PRElGSUVSX1NUQVJULCBGSVRaUEFUUklDS19NT0RJRklFUl9FTkQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ZhcmlhdGlvblNlbGVjdG9yKHN0cmluZzogc3RyaW5nKVxue1xuXHRyZXR1cm4gdHlwZW9mIHN0cmluZyA9PT0gJ3N0cmluZycgJiYgYmV0d2VlbkluY2x1c2l2ZShzdHJpbmcuY2hhckNvZGVBdCgwKSwgVkFSSUFUSU9OX01PRElGSUVSX1NUQVJULCBWQVJJQVRJT05fTU9ESUZJRVJfRU5EKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNEaWFjcml0aWNhbE1hcmsoc3RyaW5nOiBzdHJpbmcpXG57XG5cdHJldHVybiB0eXBlb2Ygc3RyaW5nID09PSAnc3RyaW5nJyAmJiBiZXR3ZWVuSW5jbHVzaXZlKHN0cmluZy5jaGFyQ29kZUF0KDApLCBESUFDUklUSUNBTF9NQVJLU19TVEFSVCwgRElBQ1JJVElDQUxfTUFSS1NfRU5EKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNHcmFwaGVtKHN0cmluZzogc3RyaW5nKVxue1xuXHRyZXR1cm4gdHlwZW9mIHN0cmluZyA9PT0gJ3N0cmluZycgJiYgR1JBUEhFTVMuaW5kZXhPZihzdHJpbmcuY2hhckNvZGVBdCgwKSkgIT09IC0xXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1plcm9XaWR0aEpvaW5lcihzdHJpbmc6IHN0cmluZylcbntcblx0cmV0dXJuIHR5cGVvZiBzdHJpbmcgPT09ICdzdHJpbmcnICYmIHN0cmluZy5jaGFyQ29kZUF0KDApID09PSBaV0pcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvZGVQb2ludEZyb21TdXJyb2dhdGVQYWlyKHBhaXI6IHN0cmluZylcbntcblx0Y29uc3QgaGlnaE9mZnNldCA9IHBhaXIuY2hhckNvZGVBdCgwKSAtIEhJR0hfU1VSUk9HQVRFX1NUQVJUXG5cdGNvbnN0IGxvd09mZnNldCA9IHBhaXIuY2hhckNvZGVBdCgxKSAtIExPV19TVVJST0dBVEVfU1RBUlRcblx0cmV0dXJuIChoaWdoT2Zmc2V0IDw8IDEwKSArIGxvd09mZnNldCArIDB4MTAwMDBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJldHdlZW5JbmNsdXNpdmUodmFsdWU6IG51bWJlciwgbG93ZXI6IG51bWJlciwgdXBwZXI6IG51bWJlcilcbntcblx0cmV0dXJuIHZhbHVlID49IGxvd2VyICYmIHZhbHVlIDw9IHVwcGVyXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdWJzdHJpbmcoc3RyaW5nOiBzdHJpbmcsIHN0YXJ0OiBudW1iZXIsIHdpZHRoPzogbnVtYmVyKVxue1xuXHRjb25zdCBjaGFycyA9IHJ1bmVzKHN0cmluZylcblx0aWYgKHN0YXJ0ID09PSB1bmRlZmluZWQpXG5cdHtcblx0XHRyZXR1cm4gc3RyaW5nXG5cdH1cblx0aWYgKHN0YXJ0ID49IGNoYXJzLmxlbmd0aClcblx0e1xuXHRcdHJldHVybiAnJ1xuXHR9XG5cdGNvbnN0IHJlc3QgPSBjaGFycy5sZW5ndGggLSBzdGFydFxuXHRjb25zdCBzdHJpbmdXaWR0aCA9IHdpZHRoID09PSB1bmRlZmluZWQgPyByZXN0IDogd2lkdGhcblx0bGV0IGVuZEluZGV4ID0gc3RhcnQgKyBzdHJpbmdXaWR0aFxuXHRpZiAoZW5kSW5kZXggPiAoc3RhcnQgKyByZXN0KSlcblx0e1xuXHRcdGVuZEluZGV4ID0gdW5kZWZpbmVkXG5cdH1cblx0cmV0dXJuIGNoYXJzLnNsaWNlKHN0YXJ0LCBlbmRJbmRleCkuam9pbignJylcbn1cblxuZXhwb3J0IGNvbnN0IHN1YnN0ciA9IHN1YnN0cmluZ1xuXG5ydW5lcy5zdWJzdHIgPSBzdWJzdHJpbmc7XG5ydW5lcy5zdWJzdHJpbmcgPSBzdWJzdHJpbmc7XG5cbnJ1bmVzLmRlZmF1bHQgPSBydW5lcztcbnJ1bmVzLnJ1bmVzID0gcnVuZXM7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShydW5lcywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJ1bmVzXG5cbiJdfQ==