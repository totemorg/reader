"use strict";
/**
 * Created by user on 2018/3/16/016.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const runes2_1 = require("runes2");
const es6_class_prototype_1 = require("es6-class-prototype");
exports.STRING_PROTOTYPE = Object.getOwnPropertyNames(String.prototype);
class UString extends String {
    constructor(str, ...argv) {
        super(str);
        this._arr = null;
        let d = Object.getOwnPropertyDescriptor(this, '_arr');
        Object.defineProperty(this, '_arr', Object.assign(d, {
            configurable: true,
            enumerable: false,
        }));
    }
    [Symbol.iterator]() {
        return UString.toArray(this)[Symbol.iterator]();
    }
    static isString(str) {
        return (typeof str == 'string' || str instanceof String);
    }
    static toArray(str) {
        if (str instanceof UString) {
            return str.toArray();
        }
        return runes2_1.default(String(str));
    }
    toArray() {
        if (!this._arr) {
            this._arr = runes2_1.default(String(this));
        }
        return this._arr;
    }
    split(separator, limit) {
        let ret;
        let str = String(this);
        if (separator === '') {
            ret = UString.toArray(this);
            if (typeof limit != 'undefined') {
                ret = ret.slice(0, limit);
            }
        }
        else {
            ret = String.prototype.split.call(str, separator, limit);
        }
        return ret;
    }
    substr(start, length) {
        return UString.toArray(this).slice(start).slice(0, length).join('');
    }
    substring(start, indexEnd) {
        if (Number.isNaN(start) || start < 0) {
            start = 0;
        }
        if (typeof indexEnd == 'number') {
            if (Number.isNaN(indexEnd) || indexEnd < 0) {
                indexEnd = 0;
            }
            if (start > indexEnd) {
                [start, indexEnd] = [indexEnd, start];
            }
        }
        return this.slice(start, indexEnd);
    }
    indexOf(search, start = 0) {
        let a = UString.toArray(this);
        start = Math.max(0, Math.min(a.length, start));
        search = String(search);
        if (search === '') {
            return start;
        }
        a = a.slice(start);
        let s = UString.toArray(search);
        let i = 0;
        let j = 0;
        let se = s[s.length - 1];
        do {
            i = a.indexOf(s[0], j);
            if (i != -1) {
                if (a.slice(i, i + s.length).join('') == search) {
                    return start + i;
                }
                j = i;
                if (s.length > 1) {
                    i = a.indexOf(se, i + 1);
                    j = i - s.length;
                }
            }
            j++;
        } while (i != -1 && j < a.length);
        return -1;
    }
    includes(search, start = 0) {
        return UString.toArray(this).slice(start).join('').indexOf(search) !== -1;
    }
    slice(start, indexEnd) {
        return UString.toArray(this).slice(start, indexEnd).join('');
    }
    charAt(index) {
        return this.substr(index, 1);
    }
    startsWith(search, pos) {
        return this.substr(!pos || pos < 0 ? 0 : +pos, search.length)
            .indexOf(search) == 0;
    }
    endsWith(search, length) {
        let a = UString.toArray(this);
        let s = UString.toArray(search);
        if (length === undefined || length > a.length) {
            length = a.length;
        }
        return this.substring(length - s.length, length) === search;
    }
    padEnd(targetLength, padString) {
        targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
        padString = String((typeof padString !== 'undefined' ? padString : ' '));
        let str = this.split('');
        let pad = this.split.call(padString, '');
        if (str.length > targetLength) {
            return String(this);
        }
        else {
            targetLength = targetLength - str.length;
            if (targetLength > pad.length) {
                padString += padString.repeat(targetLength / pad.length); //append to original to ensure we are longer than needed
                // @ts-ignore
                pad = new UString(padString);
            }
            return String(this) + pad.slice(0, targetLength);
        }
    }
    padStart(targetLength, padString) {
        targetLength = targetLength >> 0; //truncate if number or convert non-number to 0;
        padString = String((typeof padString !== 'undefined' ? padString : ' '));
        let str = this.split('');
        let pad = this.split.call(padString, '');
        if (str.length > targetLength) {
            return String(this);
        }
        else {
            targetLength = targetLength - str.length;
            if (targetLength > pad.length) {
                padString += padString.repeat(targetLength / pad.length); //append to original to ensure we are longer than needed
                // @ts-ignore
                pad = new UString(padString);
            }
            return pad.slice(0, targetLength) + String(this);
        }
    }
    /**
     * 𠮷 134071 20bb7
     */
    codePointAt(pos) {
        return this.toArray()[pos].codePointAt(0);
    }
    static create(str, ...argv) {
        return new this(str, ...argv);
    }
    /**
     * 顯示 目前支援 unicode 的 method
     */
    static get support() {
        let prototype = es6_class_prototype_1.default(this);
        return Object.keys(prototype).reduce(function (a, b) {
            if (exports.STRING_PROTOTYPE.includes(b)) {
                a[b] = true;
            }
            return a;
        }, {});
    }
    static indexOf(str, search, start = 0) {
        return this.create(str).indexOf(search, start);
    }
    static includes(str, search, start = 0) {
        return this.create(str).includes(search, start);
    }
    /**
     * splits a String object into an array of strings by separating the string into substrings, using a specified separator string to determine where to make each split.
     */
    static split(str, separator, limit) {
        return this.create(str).split(separator, limit);
    }
    static substr(str, start, length) {
        return this.create(str).substr(start, length);
    }
    static substring(str, start, indexEnd) {
        return this.create(str).substring(start, indexEnd);
    }
    static slice(str, start, indexEnd) {
        return this.create(str).slice(start, indexEnd);
    }
    static charAt(str, index) {
        return this.create(str).charAt(index);
    }
    static padEnd(str, targetLength, padString) {
        return this.create(str).padEnd(targetLength, padString);
    }
    static padStart(str, targetLength, padString) {
        return this.create(str).padStart(targetLength, padString);
    }
    static startsWith(str, search, pos) {
        return this.create(str).startsWith(search, pos);
    }
    static endsWith(str, search, length) {
        return this.create(str).endsWith(search, length);
    }
    get charLength() {
        return UString.toArray(this).length;
    }
    size() {
        return UString.toArray(this).length;
    }
    static size(str) {
        return this.create(str).size();
    }
    /**
     * 𠮷 134071 20bb7
     */
    static codePointAt(str, pos) {
        return this.create(str).codePointAt(pos);
    }
}
UString.UString = UString;
/**
 * @private
 */
UString.default = UString;
exports.UString = UString;
exports.default = UString;
// @ts-ignore
Object.defineProperty(UString, "__esModule", { value: true });
// @ts-ignore
UString.default = UString.UString = UString;
// @ts-ignore
exports = Object.freeze(exports);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILG1DQUEyQjtBQUMzQiw2REFBaUQ7QUFFcEMsUUFBQSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBRTdFLE1BQWEsT0FBUSxTQUFRLE1BQU07SUFJbEMsWUFBWSxHQUFHLEVBQUUsR0FBRyxJQUFJO1FBRXZCLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUpGLFNBQUksR0FBYSxJQUFJLENBQUM7UUFNL0IsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLHdCQUF3QixDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN0RCxNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUU7WUFDcEQsWUFBWSxFQUFFLElBQUk7WUFDbEIsVUFBVSxFQUFFLEtBQUs7U0FDakIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1FBRWhCLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztJQUNqRCxDQUFDO0lBRUQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHO1FBRWxCLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxRQUFRLElBQUksR0FBRyxZQUFZLE1BQU0sQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFRCxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUc7UUFFakIsSUFBSSxHQUFHLFlBQVksT0FBTyxFQUMxQjtZQUNDLE9BQU8sR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1NBQ3JCO1FBRUQsT0FBTyxnQkFBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FB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LENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUN6QyxDQUFDOztBQTdITSxlQUFPLEdBQUcsT0FBTyxDQUFDO0FBQ3pCOztHQUVHO0FBQ0ksZUFBTyxHQUFHLE9BQU8sQ0FBQztBQXJQMUIsMEJBZ1hDO0FBRUQsa0JBQWUsT0FBTyxDQUFDO0FBRXZCLGFBQWE7QUFDYixNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxZQUFZLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUU5RCxhQUFhO0FBQ2IsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztBQUU1QyxhQUFhO0FBQ2IsT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgdXNlciBvbiAyMDE4LzMvMTYvMDE2LlxuICovXG5cbmltcG9ydCBydW5lcyBmcm9tICdydW5lczInO1xuaW1wb3J0IGNsYXNzUHJvdG90eXBlIGZyb20gXCJlczYtY2xhc3MtcHJvdG90eXBlXCI7XG5cbmV4cG9ydCBjb25zdCBTVFJJTkdfUFJPVE9UWVBFID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoU3RyaW5nLnByb3RvdHlwZSk7XG5cbmV4cG9ydCBjbGFzcyBVU3RyaW5nIGV4dGVuZHMgU3RyaW5nXG57XG5cdHByb3RlY3RlZCBfYXJyOiBzdHJpbmdbXSA9IG51bGw7XG5cblx0Y29uc3RydWN0b3Ioc3RyLCAuLi5hcmd2KVxuXHR7XG5cdFx0c3VwZXIoc3RyKTtcblxuXHRcdGxldCBkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0aGlzLCAnX2FycicpO1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnX2FycicsIE9iamVjdC5hc3NpZ24oZCwge1xuXHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlLFxuXHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXG5cdFx0fSkpO1xuXHR9XG5cblx0W1N5bWJvbC5pdGVyYXRvcl0oKVxuXHR7XG5cdFx0cmV0dXJuIFVTdHJpbmcudG9BcnJheSh0aGlzKVtTeW1ib2wuaXRlcmF0b3JdKCk7XG5cdH1cblxuXHRzdGF0aWMgaXNTdHJpbmcoc3RyKTogYm9vbGVhblxuXHR7XG5cdFx0cmV0dXJuICh0eXBlb2Ygc3RyID09ICdzdHJpbmcnIHx8IHN0ciBpbnN0YW5jZW9mIFN0cmluZyk7XG5cdH1cblxuXHRzdGF0aWMgdG9BcnJheShzdHIpXG5cdHtcblx0XHRpZiAoc3RyIGluc3RhbmNlb2YgVVN0cmluZylcblx0XHR7XG5cdFx0XHRyZXR1cm4gc3RyLnRvQXJyYXkoKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcnVuZXMoU3RyaW5nKHN0cikpO1xuXHR9XG5cblx0dG9BcnJheSgpOiBzdHJpbmdbXVxuXHR7XG5cdFx0aWYgKCF0aGlzLl9hcnIpXG5cdFx0e1xuXHRcdFx0dGhpcy5fYXJyID0gcnVuZXMoU3RyaW5nKHRoaXMpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5fYXJyO1xuXHR9XG5cblx0c3BsaXQoc2VwYXJhdG9yPywgbGltaXQ/OiBudW1iZXIpOiBzdHJpbmdbXVxuXHR7XG5cdFx0bGV0IHJldDogc3RyaW5nW107XG5cdFx0bGV0IHN0ciA9IFN0cmluZyh0aGlzKTtcblxuXHRcdGlmIChzZXBhcmF0b3IgPT09ICcnKVxuXHRcdHtcblx0XHRcdHJldCA9IFVTdHJpbmcudG9BcnJheSh0aGlzKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBsaW1pdCAhPSAndW5kZWZpbmVkJylcblx0XHRcdHtcblx0XHRcdFx0cmV0ID0gcmV0LnNsaWNlKDAsIGxpbWl0KTtcblx0XHRcdH1cblx0XHR9XG5cdFx0ZWxzZVxuXHRcdHtcblx0XHRcdHJldCA9IFN0cmluZy5wcm90b3R5cGUuc3BsaXQuY2FsbChzdHIsIHNlcGFyYXRvciwgbGltaXQpXG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJldDtcblx0fVxuXG5cdHN1YnN0cihzdGFydDogbnVtYmVyLCBsZW5ndGg/OiBudW1iZXIpOiBzdHJpbmdcblx0e1xuXHRcdHJldHVybiBVU3RyaW5nLnRvQXJyYXkodGhpcykuc2xpY2Uoc3RhcnQpLnNsaWNlKDAsIGxlbmd0aCkuam9pbignJyk7XG5cdH1cblxuXHRzdWJzdHJpbmcoc3RhcnQ6IG51bWJlciwgaW5kZXhFbmQ/OiBudW1iZXIpXG5cdHtcblx0XHRpZiAoTnVtYmVyLmlzTmFOKHN0YXJ0KSB8fCBzdGFydCA8IDApXG5cdFx0e1xuXHRcdFx0c3RhcnQgPSAwO1xuXHRcdH1cblxuXHRcdGlmICh0eXBlb2YgaW5kZXhFbmQgPT0gJ251bWJlcicpXG5cdFx0e1xuXHRcdFx0aWYgKE51bWJlci5pc05hTihpbmRleEVuZCkgfHwgaW5kZXhFbmQgPCAwKVxuXHRcdFx0e1xuXHRcdFx0XHRpbmRleEVuZCA9IDA7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChzdGFydCA+IGluZGV4RW5kKVxuXHRcdFx0e1xuXHRcdFx0XHRbc3RhcnQsIGluZGV4RW5kXSA9IFtpbmRleEVuZCwgc3RhcnRdO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnNsaWNlKHN0YXJ0LCBpbmRleEVuZCk7XG5cdH1cblxuXHRpbmRleE9mKHNlYXJjaDogc3RyaW5nLCBzdGFydDogbnVtYmVyID0gMCk6IG51bWJlclxuXHR7XG5cdFx0bGV0IGEgPSBVU3RyaW5nLnRvQXJyYXkodGhpcyk7XG5cblx0XHRzdGFydCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGEubGVuZ3RoLCBzdGFydCkpO1xuXHRcdHNlYXJjaCA9IFN0cmluZyhzZWFyY2gpO1xuXG5cdFx0aWYgKHNlYXJjaCA9PT0gJycpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIHN0YXJ0O1xuXHRcdH1cblxuXHRcdGEgPSBhLnNsaWNlKHN0YXJ0KTtcblxuXHRcdGxldCBzID0gVVN0cmluZy50b0FycmF5KHNlYXJjaCk7XG5cblx0XHRsZXQgaSA9IDA7XG5cdFx0bGV0IGogPSAwO1xuXG5cdFx0bGV0IHNlID0gc1tzLmxlbmd0aCAtIDFdO1xuXG5cdFx0ZG9cblx0XHR7XG5cdFx0XHRpID0gYS5pbmRleE9mKHNbMF0sIGopO1xuXG5cdFx0XHRpZiAoaSAhPSAtMSlcblx0XHRcdHtcblx0XHRcdFx0aWYgKGEuc2xpY2UoaSwgaSArIHMubGVuZ3RoKS5qb2luKCcnKSA9PSBzZWFyY2gpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRyZXR1cm4gc3RhcnQgKyBpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aiA9IGk7XG5cblx0XHRcdFx0aWYgKHMubGVuZ3RoID4gMSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGkgPSBhLmluZGV4T2Yoc2UsIGkgKyAxKTtcblx0XHRcdFx0XHRqID0gaSAtIHMubGVuZ3RoO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGorKztcblx0XHR9XG5cdFx0d2hpbGUgKGkgIT0gLTEgJiYgaiA8IGEubGVuZ3RoKTtcblxuXHRcdHJldHVybiAtMTtcblx0fVxuXG5cdGluY2x1ZGVzKHNlYXJjaDogc3RyaW5nLCBzdGFydDogbnVtYmVyID0gMClcblx0e1xuXHRcdHJldHVybiBVU3RyaW5nLnRvQXJyYXkodGhpcykuc2xpY2Uoc3RhcnQpLmpvaW4oJycpLmluZGV4T2Yoc2VhcmNoKSAhPT0gLTFcblx0fVxuXG5cdHNsaWNlKHN0YXJ0OiBudW1iZXIsIGluZGV4RW5kPzogbnVtYmVyKVxuXHR7XG5cdFx0cmV0dXJuIFVTdHJpbmcudG9BcnJheSh0aGlzKS5zbGljZShzdGFydCwgaW5kZXhFbmQpLmpvaW4oJycpO1xuXHR9XG5cblx0Y2hhckF0KGluZGV4OiBudW1iZXIpOiBzdHJpbmdcblx0e1xuXHRcdHJldHVybiB0aGlzLnN1YnN0cihpbmRleCwgMSk7XG5cdH1cblxuXHRzdGFydHNXaXRoKHNlYXJjaDogc3RyaW5nLCBwb3M/OiBudW1iZXIpOiBib29sZWFuXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5zdWJzdHIoIXBvcyB8fCBwb3MgPCAwID8gMCA6ICtwb3MsIHNlYXJjaC5sZW5ndGgpXG5cdFx0XHQuaW5kZXhPZihzZWFyY2gpID09IDBcblx0XHRcdDtcblx0fVxuXG5cdGVuZHNXaXRoKHNlYXJjaDogc3RyaW5nLCBsZW5ndGg/OiBudW1iZXIpOiBib29sZWFuXG5cdHtcblx0XHRsZXQgYSA9IFVTdHJpbmcudG9BcnJheSh0aGlzKTtcblx0XHRsZXQgcyA9IFVTdHJpbmcudG9BcnJheShzZWFyY2gpO1xuXG5cdFx0aWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkIHx8IGxlbmd0aCA+IGEubGVuZ3RoKVxuXHRcdHtcblx0XHRcdGxlbmd0aCA9IGEubGVuZ3RoO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnN1YnN0cmluZyhsZW5ndGggLSBzLmxlbmd0aCwgbGVuZ3RoKSA9PT0gc2VhcmNoO1xuXHR9XG5cblx0cGFkRW5kKHRhcmdldExlbmd0aDogbnVtYmVyLCBwYWRTdHJpbmc6IHN0cmluZylcblx0e1xuXHRcdHRhcmdldExlbmd0aCA9IHRhcmdldExlbmd0aCA+PiAwOyAvL2Zsb29yIGlmIG51bWJlciBvciBjb252ZXJ0IG5vbi1udW1iZXIgdG8gMDtcblx0XHRwYWRTdHJpbmcgPSBTdHJpbmcoKHR5cGVvZiBwYWRTdHJpbmcgIT09ICd1bmRlZmluZWQnID8gcGFkU3RyaW5nIDogJyAnKSk7XG5cblx0XHRsZXQgc3RyID0gdGhpcy5zcGxpdCgnJyk7XG5cdFx0bGV0IHBhZCA9IHRoaXMuc3BsaXQuY2FsbChwYWRTdHJpbmcsICcnKTtcblxuXHRcdGlmIChzdHIubGVuZ3RoID4gdGFyZ2V0TGVuZ3RoKVxuXHRcdHtcblx0XHRcdHJldHVybiBTdHJpbmcodGhpcyk7XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHR0YXJnZXRMZW5ndGggPSB0YXJnZXRMZW5ndGggLSBzdHIubGVuZ3RoO1xuXHRcdFx0aWYgKHRhcmdldExlbmd0aCA+IHBhZC5sZW5ndGgpXG5cdFx0XHR7XG5cdFx0XHRcdHBhZFN0cmluZyArPSBwYWRTdHJpbmcucmVwZWF0KHRhcmdldExlbmd0aCAvIHBhZC5sZW5ndGgpOyAvL2FwcGVuZCB0byBvcmlnaW5hbCB0byBlbnN1cmUgd2UgYXJlIGxvbmdlciB0aGFuIG5lZWRlZFxuXG5cdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0cGFkID0gbmV3IFVTdHJpbmcocGFkU3RyaW5nKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBTdHJpbmcodGhpcykgKyBwYWQuc2xpY2UoMCwgdGFyZ2V0TGVuZ3RoKTtcblx0XHR9XG5cdH1cblxuXHRwYWRTdGFydCh0YXJnZXRMZW5ndGg6IG51bWJlciwgcGFkU3RyaW5nOiBzdHJpbmcpXG5cdHtcblx0XHR0YXJnZXRMZW5ndGggPSB0YXJnZXRMZW5ndGggPj4gMDsgLy90cnVuY2F0ZSBpZiBudW1iZXIgb3IgY29udmVydCBub24tbnVtYmVyIHRvIDA7XG5cdFx0cGFkU3RyaW5nID0gU3RyaW5nKCh0eXBlb2YgcGFkU3RyaW5nICE9PSAndW5kZWZpbmVkJyA/IHBhZFN0cmluZyA6ICcgJykpO1xuXG5cdFx0bGV0IHN0ciA9IHRoaXMuc3BsaXQoJycpO1xuXHRcdGxldCBwYWQgPSB0aGlzLnNwbGl0LmNhbGwocGFkU3RyaW5nLCAnJyk7XG5cblx0XHRpZiAoc3RyLmxlbmd0aCA+IHRhcmdldExlbmd0aClcblx0XHR7XG5cdFx0XHRyZXR1cm4gU3RyaW5nKHRoaXMpO1xuXHRcdH1cblx0XHRlbHNlXG5cdFx0e1xuXHRcdFx0dGFyZ2V0TGVuZ3RoID0gdGFyZ2V0TGVuZ3RoIC0gc3RyLmxlbmd0aDtcblx0XHRcdGlmICh0YXJnZXRMZW5ndGggPiBwYWQubGVuZ3RoKVxuXHRcdFx0e1xuXHRcdFx0XHRwYWRTdHJpbmcgKz0gcGFkU3RyaW5nLnJlcGVhdCh0YXJnZXRMZW5ndGggLyBwYWQubGVuZ3RoKTsgLy9hcHBlbmQgdG8gb3JpZ2luYWwgdG8gZW5zdXJlIHdlIGFyZSBsb25nZXIgdGhhbiBuZWVkZWRcblxuXHRcdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRcdHBhZCA9IG5ldyBVU3RyaW5nKHBhZFN0cmluZyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBwYWQuc2xpY2UoMCwgdGFyZ2V0TGVuZ3RoKSArIFN0cmluZyh0aGlzKTtcblx0XHR9XG5cdH1cblxuXG5cblx0LyoqXG5cdCAqIPCgrrcgMTM0MDcxIDIwYmI3XG5cdCAqL1xuXHRjb2RlUG9pbnRBdChwb3M6IG51bWJlcik6IG51bWJlclxuXHR7XG5cdFx0cmV0dXJuIHRoaXMudG9BcnJheSgpW3Bvc10uY29kZVBvaW50QXQoMClcblx0fVxuXG5cdHN0YXRpYyBVU3RyaW5nID0gVVN0cmluZztcblx0LyoqXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRzdGF0aWMgZGVmYXVsdCA9IFVTdHJpbmc7XG5cblx0c3RhdGljIGNyZWF0ZShzdHIsIC4uLmFyZ3YpXG5cdHtcblx0XHRyZXR1cm4gbmV3IHRoaXMoc3RyLCAuLi5hcmd2KTtcblx0fVxuXG5cdC8qKlxuXHQgKiDpoa/npLog55uu5YmN5pSv5o+0IHVuaWNvZGUg55qEIG1ldGhvZFxuXHQgKi9cblx0c3RhdGljIGdldCBzdXBwb3J0KCk6IHtcblxuXHRcdHNwbGl0PzogYm9vbGVhbixcblx0XHRzdWJzdHI/OiBib29sZWFuLFxuXHRcdHN1YnN0cmluZz86IGJvb2xlYW4sXG5cdFx0aW5kZXhPZj86IGJvb2xlYW4sXG5cdFx0aW5jbHVkZXM/OiBib29sZWFuLFxuXHRcdHNsaWNlPzogYm9vbGVhbixcblx0XHRjaGFyQXQ/OiBib29sZWFuLFxuXHRcdHN0YXJ0c1dpdGg/OiBib29sZWFuLFxuXHRcdGVuZHNXaXRoPzogYm9vbGVhbixcblx0XHRwYWRFbmQ/OiBib29sZWFuLFxuXHRcdHBhZFN0YXJ0PzogYm9vbGVhbixcblxuXHRcdGNvZGVQb2ludEF0PzogYm9vbGVhbixcblxuXHRcdFtrZXk6IHN0cmluZ106IGJvb2xlYW4sXG5cdH1cblx0e1xuXHRcdGxldCBwcm90b3R5cGUgPSBjbGFzc1Byb3RvdHlwZSh0aGlzKTtcblxuXHRcdHJldHVybiBPYmplY3Qua2V5cyhwcm90b3R5cGUpLnJlZHVjZShmdW5jdGlvbiAoYSwgYilcblx0XHR7XG5cdFx0XHRpZiAoU1RSSU5HX1BST1RPVFlQRS5pbmNsdWRlcyhiKSlcblx0XHRcdHtcblx0XHRcdFx0YVtiXSA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBhO1xuXHRcdH0sIHt9KVxuXHR9XG5cblx0c3RhdGljIGluZGV4T2Yoc3RyLCBzZWFyY2g6IHN0cmluZywgc3RhcnQ6IG51bWJlciA9IDApXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoc3RyKS5pbmRleE9mKHNlYXJjaCwgc3RhcnQpO1xuXHR9XG5cblx0c3RhdGljIGluY2x1ZGVzKHN0ciwgc2VhcmNoOiBzdHJpbmcsIHN0YXJ0OiBudW1iZXIgPSAwKVxuXHR7XG5cdFx0cmV0dXJuIHRoaXMuY3JlYXRlKHN0cikuaW5jbHVkZXMoc2VhcmNoLCBzdGFydCk7XG5cdH1cblxuXHQvKipcblx0ICogc3BsaXRzIGEgU3RyaW5nIG9iamVjdCBpbnRvIGFuIGFycmF5IG9mIHN0cmluZ3MgYnkgc2VwYXJhdGluZyB0aGUgc3RyaW5nIGludG8gc3Vic3RyaW5ncywgdXNpbmcgYSBzcGVjaWZpZWQgc2VwYXJhdG9yIHN0cmluZyB0byBkZXRlcm1pbmUgd2hlcmUgdG8gbWFrZSBlYWNoIHNwbGl0LlxuXHQgKi9cblx0c3RhdGljIHNwbGl0KHN0ciwgc2VwYXJhdG9yPzogYW55LCBsaW1pdD86IG51bWJlcilcblx0e1xuXHRcdHJldHVybiB0aGlzLmNyZWF0ZShzdHIpLnNwbGl0KHNlcGFyYXRvciwgbGltaXQpO1xuXHR9XG5cblx0c3RhdGljIHN1YnN0cihzdHIsIHN0YXJ0OiBudW1iZXIsIGxlbmd0aD86IG51bWJlcilcblx0e1xuXHRcdHJldHVybiB0aGlzLmNyZWF0ZShzdHIpLnN1YnN0cihzdGFydCwgbGVuZ3RoKTtcblx0fVxuXG5cdHN0YXRpYyBzdWJzdHJpbmcoc3RyLCBzdGFydDogbnVtYmVyLCBpbmRleEVuZD86IG51bWJlcilcblx0e1xuXHRcdHJldHVybiB0aGlzLmNyZWF0ZShzdHIpLnN1YnN0cmluZyhzdGFydCwgaW5kZXhFbmQpO1xuXHR9XG5cblx0c3RhdGljIHNsaWNlKHN0ciwgc3RhcnQ6IG51bWJlciwgaW5kZXhFbmQ/OiBudW1iZXIpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoc3RyKS5zbGljZShzdGFydCwgaW5kZXhFbmQpO1xuXHR9XG5cblx0c3RhdGljIGNoYXJBdChzdHIsIGluZGV4OiBudW1iZXIpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoc3RyKS5jaGFyQXQoaW5kZXgpO1xuXHR9XG5cblx0c3RhdGljIHBhZEVuZChzdHIsIHRhcmdldExlbmd0aDogbnVtYmVyLCBwYWRTdHJpbmc6IHN0cmluZylcblx0e1xuXHRcdHJldHVybiB0aGlzLmNyZWF0ZShzdHIpLnBhZEVuZCh0YXJnZXRMZW5ndGgsIHBhZFN0cmluZyk7XG5cdH1cblxuXHRzdGF0aWMgcGFkU3RhcnQoc3RyLCB0YXJnZXRMZW5ndGg6IG51bWJlciwgcGFkU3RyaW5nOiBzdHJpbmcpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoc3RyKS5wYWRTdGFydCh0YXJnZXRMZW5ndGgsIHBhZFN0cmluZyk7XG5cdH1cblxuXHRzdGF0aWMgc3RhcnRzV2l0aChzdHIsIHNlYXJjaDogc3RyaW5nLCBwb3M/OiBudW1iZXIpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoc3RyKS5zdGFydHNXaXRoKHNlYXJjaCwgcG9zKTtcblx0fVxuXG5cdHN0YXRpYyBlbmRzV2l0aChzdHIsIHNlYXJjaDogc3RyaW5nLCBsZW5ndGg/OiBudW1iZXIpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoc3RyKS5lbmRzV2l0aChzZWFyY2gsIGxlbmd0aCk7XG5cdH1cblxuXHRnZXQgY2hhckxlbmd0aCgpXG5cdHtcblx0XHRyZXR1cm4gVVN0cmluZy50b0FycmF5KHRoaXMpLmxlbmd0aDtcblx0fVxuXG5cdHNpemUoKVxuXHR7XG5cdFx0cmV0dXJuIFVTdHJpbmcudG9BcnJheSh0aGlzKS5sZW5ndGg7XG5cdH1cblxuXHRzdGF0aWMgc2l6ZShzdHIpXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoc3RyKS5zaXplKCk7XG5cdH1cblxuXHQvKipcblx0ICog8KCutyAxMzQwNzEgMjBiYjdcblx0ICovXG5cdHN0YXRpYyBjb2RlUG9pbnRBdChzdHIsIHBvczogbnVtYmVyKTogbnVtYmVyXG5cdHtcblx0XHRyZXR1cm4gdGhpcy5jcmVhdGUoc3RyKS5jb2RlUG9pbnRBdChwb3MpXG5cdH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBVU3RyaW5nO1xuXG4vLyBAdHMtaWdub3JlXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoVVN0cmluZywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5cbi8vIEB0cy1pZ25vcmVcblVTdHJpbmcuZGVmYXVsdCA9IFVTdHJpbmcuVVN0cmluZyA9IFVTdHJpbmc7XG5cbi8vIEB0cy1pZ25vcmVcbmV4cG9ydHMgPSBPYmplY3QuZnJlZXplKGV4cG9ydHMpXG4iXX0=